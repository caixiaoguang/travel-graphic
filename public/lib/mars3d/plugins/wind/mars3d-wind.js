/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.4.20
 * 编译日期：2023-01-08 20:59:19
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2022-06-01
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';var _0x2484ff=_0x9e68;(function(_0x18fca1,_0x23d111){var _0x43f292=_0x9e68,_0x12f89=_0x18fca1();while(!![]){try{var _0x55d372=parseInt(_0x43f292(0x26c))/0x1+parseInt(_0x43f292(0x246))/0x2+parseInt(_0x43f292(0x248))/0x3*(parseInt(_0x43f292(0x1d3))/0x4)+parseInt(_0x43f292(0x1d5))/0x5+parseInt(_0x43f292(0x1e2))/0x6+-parseInt(_0x43f292(0x236))/0x7+-parseInt(_0x43f292(0x250))/0x8;if(_0x55d372===_0x23d111)break;else _0x12f89['push'](_0x12f89['shift']());}catch(_0xcc1f2e){_0x12f89['push'](_0x12f89['shift']());}}}(_0x539d,0xe6961));function _interopNamespace(_0x448015){var _0x15d235=_0x9e68;if(_0x448015&&_0x448015['__esModule'])return _0x448015;var _0x264836=Object['create'](null);return _0x448015&&Object['keys'](_0x448015)['forEach'](function(_0x24418a){if(_0x24418a!=='default'){var _0x580f18=Object['getOwnPropertyDescriptor'](_0x448015,_0x24418a);Object['defineProperty'](_0x264836,_0x24418a,_0x580f18['get']?_0x580f18:{'enumerable':!![],'get':function(){return _0x448015[_0x24418a];}});}}),_0x264836[_0x15d235(0x18a)]=_0x448015,_0x264836;}var mars3d__namespace=_interopNamespace(mars3d),Cesium$7=mars3d__namespace['Cesium'];function getU(_0x47093e,_0x3684cf){var _0x2608c3=_0x9e68,_0x505670=_0x47093e*Math['cos'](Cesium$7[_0x2608c3(0x20f)]['toRadians'](_0x3684cf));return _0x505670;}function getV(_0x4394db,_0x480fd4){var _0x33b309=_0x9e68,_0x36bd51=_0x4394db*Math['sin'](Cesium$7[_0x33b309(0x20f)]['toRadians'](_0x480fd4));return _0x36bd51;}function getSpeed(_0x1209fd,_0x9fb4b0){var _0x43181e=Math['sqrt'](Math['pow'](_0x1209fd,0x2)+Math['pow'](_0x9fb4b0,0x2));return _0x43181e;}function getDirection(_0x211366,_0x253278){var _0x5a311a=_0x9e68,_0x1e2831=Cesium$7['Math'][_0x5a311a(0x18b)](Math['atan2'](_0x253278,_0x211366));return _0x1e2831+=_0x1e2831<0x0?0x168:0x0,_0x1e2831;}function _0x539d(){var _0x39f9fa=['dimensions','__esModule','keys','destroyParticlesTextures','register','getOptions','style','OPAQUE','createFramebuffer','cols','vmax','nextTrailsColor','udata','rgb(206,255,255)','tlat','0px','Compute','Color','canvasResize','fixedHeight','nextTrails','lng','currentTrailsDepth','_randomParticle','updateViewerParameters','_map','_onMouseUpEvent','_setOptionsHook','getDefaultRenderState','vdata','getOwnPropertySymbols','createSegmentsGeometry','DISABLE_GL_POSITION_LOG_DEPTH','valueOf','update','addEventListener','removeAll','_removedHook','outputTexture','createTexture','7206476hNKiyJ','Cartesian3','485465VzGjTE','_calc_speedRate','tlng','mouseDown','speedFactor','options','createParticlesTextures','mouse_move','framebuffer','_speedRate','ShaderProgram','bindEvent','particlesComputing','7854906RSVQcc','umax','randomBetween','textures','currentTrails','segments','function','wheel','initWorker','beginPath','fromCssColorString','viewRectangleToLonLatRange','createRenderingPrimitives','postProcessingSpeed','globeBoundingSphere','getFullscreenQuad','max','windField','container','commandType','refreshParticles','getOwnPropertyDescriptors','left','lineWidth','_addedHook','postProcessingPosition','refreshTimer','getPixelSize','_updateIng2','speedRate','grid','particlesTextures','canvas','shaderProgram','getUVByXY','visibility','windTextures','Cesium','push','commandToExecute','DepthFunction','prototype','particleSystem','ComponentDatatype','length','Math','_tomap','redraw','PixelFormat','LINEAR','windData','umin','defineProperty','fromGeometry','none','lev','animateFrame','strokeStyle','_drawLines','visible','red','_onMap_preRenderEvent','setDate','particlesRendering','green','worker','camera','now','setData','drawingBufferWidth','globe','rows','preRender','_onMouseMoveEvent','lineTo','ymax','canvasContext','autoClear','createRenderingTextures','DEPTH_COMPONENT','clampToLatitudeRange','clear','vertexShaderSource','depthMask','1534778ctuENp','onmessage','data','init','min','particlesNumber','EllipsoidalOccluder','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x20\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0avarying\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture2D(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture2D(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}','NEAREST','off','_showHook','log','remove','isPointVisible','source','frameTime','3600806dTZwBo','RGB','3LCIUxq','ComputeCommand','filter','Appearance','pointerEvents','xmin','particlesTextureSize','addPrimitives','32944984xSDOSI','constructor','appendChild','bind','show','_mountedHook','VertexArray','nextParticlesSpeed','maxAge','reverse','setPrototypeOf','Derived\x20constructors\x20may\x20only\x20return\x20object\x20or\x20undefined','east','construct','forEach','absolute','trails','pointer-events','_data','viewerParameters','key','scene','class','ymin','commandList','sqrt','clearCommand','GeometryAttribute','273592OBIYZT','uniformMap','mouseMove','TextureMagnificationFilter','currentParticlesPosition','vertexArray','layer','ClearCommand','#ffffff','Object','blue','globalCompositeOperation','particleHeight','framebuffers','_createCanvas','removeChild','fromCache','TWO_PI','reverseY','Draw','mouse_down','nextParticlesPosition','PixelDatatype','randomizeParticles','isDestroyed','lat','updatePosition','context','segmentsDepth','Pass','dropRate','currentParticlesSpeed','SCENE3D','uniform\x20sampler2D\x20trailsColorTexture;\x0d\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0d\x0a\x0d\x0avarying\x20vec2\x20textureCoordinate;\x0d\x0a\x0d\x0avoid\x20main()\x20{\x0d\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture2D(trailsColorTexture,\x20textureCoordinate);\x0d\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture2D(trailsDepthTexture,\x20textureCoordinate).r;\x0d\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture2D(czm_globeDepthTexture,\x20textureCoordinate));\x0d\x0a\x0d\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0d\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20trailsColor;\x0d\x0a\x20\x20\x20\x20}\x20else\x20{\x0d\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(0.0);\x0d\x0a\x20\x20\x20\x20}\x0d\x0a}','geometry','drawingBufferHeight','maxParticles','mouseUp','random','primitives','default','toDegrees','setOptions','particles','createRawRenderState','ShaderSource','levmin','enumerable','latRange','applyViewerParameters','Map','removeEventListener','mode','add','depthTest','canvasWindy','north','primitiveType','defined','_pointerEvents','_updateIng','lon','destroy','getUVByPoint','width','EventType','apply','pixelSize','postMessage','CanvasWindLayer','Cartesian2','toGridXY','resize'];_0x539d=function(){return _0x39f9fa;};return _0x539d();}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};function _0x9e68(_0x451411,_0x1fbc55){var _0x539d5e=_0x539d();return _0x9e68=function(_0x9e689a,_0x3b63cb){_0x9e689a=_0x9e689a-0x16f;var _0x357d2e=_0x539d5e[_0x9e689a];return _0x357d2e;},_0x9e68(_0x451411,_0x1fbc55);}function ownKeys(_0x1d9799,_0x30c9af){var _0x2192e5=_0x9e68,_0x26fd0e=Object['keys'](_0x1d9799);if(Object[_0x2192e5(0x1c9)]){var _0x42b00e=Object['getOwnPropertySymbols'](_0x1d9799);_0x30c9af&&(_0x42b00e=_0x42b00e[_0x2192e5(0x24a)](function(_0x23d352){return Object['getOwnPropertyDescriptor'](_0x1d9799,_0x23d352)['enumerable'];})),_0x26fd0e['push']['apply'](_0x26fd0e,_0x42b00e);}return _0x26fd0e;}function _objectSpread2(_0x93f404){var _0x4d50a9=_0x9e68;for(var _0x306c4f=0x1;_0x306c4f<arguments[_0x4d50a9(0x20e)];_0x306c4f++){var _0x2ab0c3=null!=arguments[_0x306c4f]?arguments[_0x306c4f]:{};_0x306c4f%0x2?ownKeys(Object(_0x2ab0c3),!0x0)['forEach'](function(_0x5a9c78){_defineProperty(_0x93f404,_0x5a9c78,_0x2ab0c3[_0x5a9c78]);}):Object[_0x4d50a9(0x1f7)]?Object['defineProperties'](_0x93f404,Object['getOwnPropertyDescriptors'](_0x2ab0c3)):ownKeys(Object(_0x2ab0c3))[_0x4d50a9(0x25e)](function(_0x2e8fa5){var _0x3f8e8b=_0x4d50a9;Object[_0x3f8e8b(0x216)](_0x93f404,_0x2e8fa5,Object['getOwnPropertyDescriptor'](_0x2ab0c3,_0x2e8fa5));});}return _0x93f404;}function _classCallCheck(_0x1fbd0b,_0xff5bed){if(!(_0x1fbd0b instanceof _0xff5bed))throw new TypeError('Cannot\x20call\x20a\x20class\x20as\x20a\x20function');}function _defineProperties(_0x4a97ac,_0x327162){var _0x36bae6=_0x9e68;for(var _0x5ac766=0x0;_0x5ac766<_0x327162['length'];_0x5ac766++){var _0x177f33=_0x327162[_0x5ac766];_0x177f33[_0x36bae6(0x191)]=_0x177f33['enumerable']||![],_0x177f33['configurable']=!![];if('value'in _0x177f33)_0x177f33['writable']=!![];Object['defineProperty'](_0x4a97ac,_0x177f33[_0x36bae6(0x264)],_0x177f33);}}function _createClass(_0x3a2aa4,_0x3a13d9,_0x3f6fac){var _0x1bd33f=_0x9e68;if(_0x3a13d9)_defineProperties(_0x3a2aa4['prototype'],_0x3a13d9);if(_0x3f6fac)_defineProperties(_0x3a2aa4,_0x3f6fac);return Object[_0x1bd33f(0x216)](_0x3a2aa4,_0x1bd33f(0x20b),{'writable':![]}),_0x3a2aa4;}function _defineProperty(_0x36500c,_0x50f3b1,_0x44871c){return _0x50f3b1 in _0x36500c?Object['defineProperty'](_0x36500c,_0x50f3b1,{'value':_0x44871c,'enumerable':!![],'configurable':!![],'writable':!![]}):_0x36500c[_0x50f3b1]=_0x44871c,_0x36500c;}function _inherits(_0x57bd1c,_0xe5f3c2){var _0x220ea4=_0x9e68;if(typeof _0xe5f3c2!==_0x220ea4(0x1e8)&&_0xe5f3c2!==null)throw new TypeError('Super\x20expression\x20must\x20either\x20be\x20null\x20or\x20a\x20function');_0x57bd1c['prototype']=Object['create'](_0xe5f3c2&&_0xe5f3c2['prototype'],{'constructor':{'value':_0x57bd1c,'writable':!![],'configurable':!![]}}),Object[_0x220ea4(0x216)](_0x57bd1c,'prototype',{'writable':![]});if(_0xe5f3c2)_setPrototypeOf(_0x57bd1c,_0xe5f3c2);}function _getPrototypeOf(_0x519ec3){var _0x5d923a=_0x9e68;return _getPrototypeOf=Object[_0x5d923a(0x25a)]?Object['getPrototypeOf']['bind']():function _0x429f20(_0x22e539){return _0x22e539['__proto__']||Object['getPrototypeOf'](_0x22e539);},_getPrototypeOf(_0x519ec3);}function _setPrototypeOf(_0x504910,_0x2cc9cd){var _0x4873c6=_0x9e68;return _setPrototypeOf=Object['setPrototypeOf']?Object[_0x4873c6(0x25a)]['bind']():function _0x5734f7(_0x41c532,_0x4316d1){return _0x41c532['__proto__']=_0x4316d1,_0x41c532;},_setPrototypeOf(_0x504910,_0x2cc9cd);}function _isNativeReflectConstruct(){var _0x524c33=_0x9e68;if(typeof Reflect==='undefined'||!Reflect['construct'])return![];if(Reflect[_0x524c33(0x25d)]['sham'])return![];if(typeof Proxy==='function')return!![];try{return Boolean['prototype'][_0x524c33(0x1cc)]['call'](Reflect['construct'](Boolean,[],function(){})),!![];}catch(_0x11e259){return![];}}function _assertThisInitialized(_0xeb8864){if(_0xeb8864===void 0x0)throw new ReferenceError('this\x20hasn\x27t\x20been\x20initialised\x20-\x20super()\x20hasn\x27t\x20been\x20called');return _0xeb8864;}function _possibleConstructorReturn(_0x9527f5,_0x4d9ad0){var _0x5efd75=_0x9e68;if(_0x4d9ad0&&(typeof _0x4d9ad0==='object'||typeof _0x4d9ad0===_0x5efd75(0x1e8)))return _0x4d9ad0;else{if(_0x4d9ad0!==void 0x0)throw new TypeError(_0x5efd75(0x25b));}return _assertThisInitialized(_0x9527f5);}function _createSuper(_0x10a1d1){var _0x2e84d0=_isNativeReflectConstruct();return function _0x52417b(){var _0x35365c=_0x9e68,_0x2b74cc=_getPrototypeOf(_0x10a1d1),_0x40c9dc;if(_0x2e84d0){var _0x33519f=_getPrototypeOf(this)['constructor'];_0x40c9dc=Reflect['construct'](_0x2b74cc,arguments,_0x33519f);}else _0x40c9dc=_0x2b74cc[_0x35365c(0x1a4)](this,arguments);return _possibleConstructorReturn(this,_0x40c9dc);};}function _toConsumableArray(_0x48b64b){return _arrayWithoutHoles(_0x48b64b)||_iterableToArray(_0x48b64b)||_unsupportedIterableToArray(_0x48b64b)||_nonIterableSpread();}function _arrayWithoutHoles(_0x1f357a){if(Array['isArray'](_0x1f357a))return _arrayLikeToArray(_0x1f357a);}function _iterableToArray(_0x4e7e05){if(typeof Symbol!=='undefined'&&_0x4e7e05[Symbol['iterator']]!=null||_0x4e7e05['@@iterator']!=null)return Array['from'](_0x4e7e05);}function _unsupportedIterableToArray(_0x5c3ea0,_0x46ee37){var _0x54cec2=_0x9e68;if(!_0x5c3ea0)return;if(typeof _0x5c3ea0==='string')return _arrayLikeToArray(_0x5c3ea0,_0x46ee37);var _0x226e43=Object['prototype']['toString']['call'](_0x5c3ea0)['slice'](0x8,-0x1);if(_0x226e43===_0x54cec2(0x275)&&_0x5c3ea0[_0x54cec2(0x251)])_0x226e43=_0x5c3ea0[_0x54cec2(0x251)]['name'];if(_0x226e43===_0x54cec2(0x194)||_0x226e43==='Set')return Array['from'](_0x5c3ea0);if(_0x226e43==='Arguments'||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/['test'](_0x226e43))return _arrayLikeToArray(_0x5c3ea0,_0x46ee37);}function _arrayLikeToArray(_0x956a9d,_0x10cef8){if(_0x10cef8==null||_0x10cef8>_0x956a9d['length'])_0x10cef8=_0x956a9d['length'];for(var _0x333394=0x0,_0x3e9d21=new Array(_0x10cef8);_0x333394<_0x10cef8;_0x333394++)_0x3e9d21[_0x333394]=_0x956a9d[_0x333394];return _0x3e9d21;}function _nonIterableSpread(){throw new TypeError('Invalid\x20attempt\x20to\x20spread\x20non-iterable\x20instance.\x0aIn\x20order\x20to\x20be\x20iterable,\x20non-array\x20objects\x20must\x20have\x20a\x20[Symbol.iterator]()\x20method.');}var Cesium$6=mars3d__namespace['Cesium'],CustomPrimitive=(function(){var _0x45ac03=_0x9e68;function _0x36e942(_0x102505){var _0x58c2d3=_0x9e68,_0x3666b3;_classCallCheck(this,_0x36e942),this[_0x58c2d3(0x1f5)]=_0x102505['commandType'],this[_0x58c2d3(0x184)]=_0x102505['geometry'],this['attributeLocations']=_0x102505['attributeLocations'],this[_0x58c2d3(0x19b)]=_0x102505['primitiveType'],this['uniformMap']=_0x102505[_0x58c2d3(0x26d)],this[_0x58c2d3(0x234)]=_0x102505[_0x58c2d3(0x234)],this['fragmentShaderSource']=_0x102505['fragmentShaderSource'],this['rawRenderState']=_0x102505['rawRenderState'],this['framebuffer']=_0x102505[_0x58c2d3(0x1dd)],this[_0x58c2d3(0x1d1)]=_0x102505['outputTexture'],this[_0x58c2d3(0x22f)]=(_0x3666b3=_0x102505['autoClear'])!==null&&_0x3666b3!==void 0x0?_0x3666b3:![],this['preExecute']=_0x102505['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this[_0x58c2d3(0x26a)]=new Cesium$6[(_0x58c2d3(0x273))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x58c2d3(0x17f)][_0x58c2d3(0x1b2)]}));}return _createClass(_0x36e942,[{'key':'createCommand','value':function _0xfd1c1b(_0x334985){var _0x1af04d=_0x9e68;switch(this[_0x1af04d(0x1f5)]){case _0x1af04d(0x175):{var _0x56e37b=Cesium$6['VertexArray'][_0x1af04d(0x217)]({'context':_0x334985,'geometry':this[_0x1af04d(0x184)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x51c9e3=Cesium$6[_0x1af04d(0x1df)][_0x1af04d(0x172)]({'context':_0x334985,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x280f1e=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x1af04d(0x19b)],'shaderProgram':_0x51c9e3,'vertexArray':_0x56e37b,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x280f1e,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this[_0x1af04d(0x1dd)],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case _0x1af04d(0x1bb):{return new Cesium$6[(_0x1af04d(0x249))]({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}},{'key':'setGeometry','value':function _0x48782e(_0x24b918,_0x2a1806){var _0x1abb5b=_0x9e68;this['geometry']=_0x2a1806;var _0x9165b9=Cesium$6[_0x1abb5b(0x256)]['fromGeometry']({'context':_0x24b918,'geometry':this[_0x1abb5b(0x184)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x9165b9;}},{'key':'update','value':function _0x2f6ab0(_0x37f808){var _0x36214b=_0x9e68;if(!this['show'])return;if(_0x37f808['mode']!==Cesium$6['SceneMode'][_0x36214b(0x182)])return;!Cesium$6['defined'](this[_0x36214b(0x209)])&&(this['commandToExecute']=this['createCommand'](_0x37f808[_0x36214b(0x17d)])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6[_0x36214b(0x19c)](this['clearCommand'])&&_0x37f808[_0x36214b(0x268)][_0x36214b(0x208)](this['clearCommand']),_0x37f808['commandList']['push'](this['commandToExecute']);}},{'key':_0x45ac03(0x17a),'value':function _0x1f3f5f(){return![];}},{'key':'destroy','value':function _0x2135ce(){var _0x2c0fda=_0x45ac03;if(this['clearCommand']){var _0xedad7e,_0x2a685a;(_0xedad7e=this['clearCommand'])!==null&&_0xedad7e!==void 0x0&&_0xedad7e['vertexArray']&&this['clearCommand']['vertexArray'][_0x2c0fda(0x1a0)](),(_0x2a685a=this['clearCommand'])!==null&&_0x2a685a!==void 0x0&&_0x2a685a['shaderProgram']&&this['clearCommand'][_0x2c0fda(0x203)]['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this[_0x2c0fda(0x209)][_0x2c0fda(0x271)]&&this['commandToExecute']['vertexArray']['destroy'](),this[_0x2c0fda(0x209)][_0x2c0fda(0x203)]&&this['commandToExecute']['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}]),_0x36e942;}()),Cesium$5=mars3d__namespace['Cesium'],Util=(function(){var _0x2c22bb=function _0x11f2cc(){var _0x5c63bb=_0x9e68,_0x2eeeb1=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x5c63bb(0x20d)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0x5c63bb(0x26b))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x2eeeb1;},_0x221fb3=function _0x2c6d27(_0x1adba4,_0x4a2aa3){var _0x436471=_0x9e68;if(Cesium$5['defined'](_0x4a2aa3)){var _0x3edb06={};_0x3edb06['arrayBufferView']=_0x4a2aa3,_0x1adba4[_0x436471(0x244)]=_0x3edb06;}var _0x2d4efb=new Cesium$5['Texture'](_0x1adba4);return _0x2d4efb;},_0x1631ab=function _0x7f1b92(_0x3f4a13,_0x43f97b,_0x3a619f){var _0x3eefd1=new Cesium$5['Framebuffer']({'context':_0x3f4a13,'colorTextures':[_0x43f97b],'depthTexture':_0x3a619f});return _0x3eefd1;},_0x12cbac=function _0xb6fd45(_0x389220){var _0x191050=_0x9e68,_0x30ad11=!![],_0x180d7e=![],_0x5c5cd1={'viewport':_0x389220['viewport'],'depthTest':_0x389220[_0x191050(0x198)],'depthMask':_0x389220[_0x191050(0x235)],'blending':_0x389220['blending']},_0x1dfd89=Cesium$5[_0x191050(0x24b)][_0x191050(0x1c7)](_0x30ad11,_0x180d7e,_0x5c5cd1);return _0x1dfd89;},_0x5af04d=function _0x15870e(_0xef19f7){var _0x25c2df=_0x9e68,_0x52587e={},_0x415236=Cesium$5[_0x25c2df(0x20f)]['mod'](_0xef19f7['west'],Cesium$5['Math']['TWO_PI']),_0x461b93=Cesium$5['Math']['mod'](_0xef19f7[_0x25c2df(0x25c)],Cesium$5[_0x25c2df(0x20f)]['TWO_PI']),_0x200092=_0xef19f7['width'],_0x200d4c,_0x5fdc77;_0x200092>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x200d4c=0x0,_0x5fdc77=Cesium$5[_0x25c2df(0x20f)][_0x25c2df(0x173)]):_0x461b93-_0x415236<_0x200092?(_0x200d4c=_0x415236,_0x5fdc77=_0x415236+_0x200092):(_0x200d4c=_0x415236,_0x5fdc77=_0x461b93);_0x52587e['lon']={'min':Cesium$5['Math']['toDegrees'](_0x200d4c),'max':Cesium$5['Math'][_0x25c2df(0x18b)](_0x5fdc77)};var _0x3e507c=_0xef19f7['south'],_0x3466bc=_0xef19f7[_0x25c2df(0x19a)],_0x5d4564=_0xef19f7['height'],_0x1182dd=_0x5d4564>Cesium$5['Math']['PI']/0xc?_0x5d4564/0x2:0x0,_0x43e77c=Cesium$5['Math']['clampToLatitudeRange'](_0x3e507c-_0x1182dd),_0x4c417d=Cesium$5['Math'][_0x25c2df(0x232)](_0x3466bc+_0x1182dd);return _0x43e77c<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x43e77c=-Cesium$5['Math']['PI_OVER_TWO']),_0x4c417d>Cesium$5['Math']['PI_OVER_THREE']&&(_0x4c417d=Cesium$5[_0x25c2df(0x20f)]['PI_OVER_TWO']),_0x52587e[_0x25c2df(0x17b)]={'min':Cesium$5['Math']['toDegrees'](_0x43e77c),'max':Cesium$5[_0x25c2df(0x20f)]['toDegrees'](_0x4c417d)},_0x52587e;};return{'getFullscreenQuad':_0x2c22bb,'createTexture':_0x221fb3,'createFramebuffer':_0x1631ab,'createRawRenderState':_0x12cbac,'viewRectangleToLonLatRange':_0x5af04d};}()),segmentDraw_vert='attribute\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0aattribute\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0avarying\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x20\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x20\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x20\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture2D(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture2D(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture2D(postProcessingSpeed,\x20particleIndex).a;\x0a}',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0avarying\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20texture2D(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}',fullscreen_vert='attribute\x20vec3\x20position;\x0d\x0aattribute\x20vec2\x20st;\x0d\x0a\x0d\x0avarying\x20vec2\x20textureCoordinate;\x0d\x0a\x0d\x0avoid\x20main()\x20{\x0d\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0d\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0d\x0a}',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0d\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0d\x0a\x0d\x0auniform\x20sampler2D\x20currentTrailsColor;\x0d\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0d\x0a\x0d\x0auniform\x20float\x20fadeOpacity;\x0d\x0a\x0d\x0avarying\x20vec2\x20textureCoordinate;\x0d\x0a\x0d\x0avoid\x20main()\x20{\x0d\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture2D(segmentsColorTexture,\x20textureCoordinate);\x0d\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture2D(currentTrailsColor,\x20textureCoordinate);\x0d\x0a\x0d\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0d\x0a\x0d\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture2D(segmentsDepthTexture,\x20textureCoordinate).r;\x0d\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture2D(trailsDepthTexture,\x20textureCoordinate).r;\x0d\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture2D(czm_globeDepthTexture,\x20textureCoordinate));\x0d\x0a\x0d\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(0.0);\x0d\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0d\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20gl_FragColor\x20+\x20pointsColor;\x0d\x0a\x20\x20\x20\x20}\x0d\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0d\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20gl_FragColor\x20+\x20trailsColor;\x0d\x0a\x20\x20\x20\x20}\x0d\x0a\x20\x20\x20\x20gl_FragDepthEXT\x20=\x20min(pointsDepth,\x20trailsDepth);\x0d\x0a}',screenDraw_frag=_0x2484ff(0x183),Cesium$4=mars3d__namespace['Cesium'],ParticlesRendering=(function(){var _0x3e945b=_0x2484ff;function _0xd80363(_0x59c15e,_0x53330e,_0x239a1b,_0x5cf367,_0x97bfa3){var _0x5c359b=_0x9e68;_classCallCheck(this,_0xd80363),this[_0x5c359b(0x230)](_0x59c15e,_0x53330e,_0x239a1b['colors']),this['createRenderingFramebuffers'](_0x59c15e),this[_0x5c359b(0x1ee)](_0x59c15e,_0x239a1b,_0x5cf367,_0x97bfa3);}return _createClass(_0xd80363,[{'key':'createRenderingTextures','value':function _0x491b8d(_0x1870cb,_0x1f6235,_0x3d98e1){var _0x57cac1=_0x9e68,_0x50df3e={'context':_0x1870cb,'width':_0x1870cb['drawingBufferWidth'],'height':_0x1870cb[_0x57cac1(0x185)],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4[_0x57cac1(0x178)]['UNSIGNED_BYTE']},_0xafd4ae={'context':_0x1870cb,'width':_0x1870cb[_0x57cac1(0x227)],'height':_0x1870cb[_0x57cac1(0x185)],'pixelFormat':Cesium$4[_0x57cac1(0x212)][_0x57cac1(0x231)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x4f7d20=_0x3d98e1[_0x57cac1(0x20e)],_0x192a9c=new Float32Array(_0x4f7d20*0x3);for(var _0x330463=0x0;_0x330463<_0x4f7d20;_0x330463++){var _0x2eeb7d=Cesium$4[_0x57cac1(0x1bc)][_0x57cac1(0x1ec)](_0x3d98e1[_0x330463]);_0x192a9c[0x3*_0x330463]=_0x2eeb7d[_0x57cac1(0x21e)],_0x192a9c[0x3*_0x330463+0x1]=_0x2eeb7d[_0x57cac1(0x222)],_0x192a9c[0x3*_0x330463+0x2]=_0x2eeb7d[_0x57cac1(0x276)];}var _0x2fbeed={'context':_0x1870cb,'width':_0x4f7d20,'height':0x1,'pixelFormat':Cesium$4[_0x57cac1(0x212)][_0x57cac1(0x247)],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter'][_0x57cac1(0x213)],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x50df3e),'segmentsDepth':Util[_0x57cac1(0x1d2)](_0xafd4ae),'currentTrailsColor':Util['createTexture'](_0x50df3e),'currentTrailsDepth':Util['createTexture'](_0xafd4ae),'nextTrailsColor':Util['createTexture'](_0x50df3e),'nextTrailsDepth':Util['createTexture'](_0xafd4ae),'colorTable':Util[_0x57cac1(0x1d2)](_0x2fbeed,_0x192a9c)};}},{'key':'createRenderingFramebuffers','value':function _0x29c254(_0xe03b6b){var _0x286d21=_0x9e68;this['framebuffers']={'segments':Util['createFramebuffer'](_0xe03b6b,this['textures']['segmentsColor'],this['textures'][_0x286d21(0x17e)]),'currentTrails':Util[_0x286d21(0x1b3)](_0xe03b6b,this['textures']['currentTrailsColor'],this[_0x286d21(0x1e5)][_0x286d21(0x1c1)]),'nextTrails':Util[_0x286d21(0x1b3)](_0xe03b6b,this['textures'][_0x286d21(0x1b6)],this['textures']['nextTrailsDepth'])};}},{'key':_0x3e945b(0x1ca),'value':function _0x14d3f6(_0x3266dd){var _0x3c32b7=_0x3e945b,_0x51d3e1=0x4,_0x12aae5=[];for(var _0x3d3a7d=0x0;_0x3d3a7d<_0x3266dd['particlesTextureSize'];_0x3d3a7d++){for(var _0x2a8059=0x0;_0x2a8059<_0x3266dd['particlesTextureSize'];_0x2a8059++){for(var _0x5c84e4=0x0;_0x5c84e4<_0x51d3e1;_0x5c84e4++){_0x12aae5['push'](_0x3d3a7d/_0x3266dd[_0x3c32b7(0x24e)]),_0x12aae5['push'](_0x2a8059/_0x3266dd['particlesTextureSize']);}}}_0x12aae5=new Float32Array(_0x12aae5);var _0x1ebb1f=[],_0x403b5e=[-0x1,0x1],_0x30323f=[-0x1,0x1];for(var _0x3598cf=0x0;_0x3598cf<_0x3266dd['maxParticles'];_0x3598cf++){for(var _0x5f4c46=0x0;_0x5f4c46<_0x51d3e1/0x2;_0x5f4c46++){for(var _0x324995=0x0;_0x324995<_0x51d3e1/0x2;_0x324995++){_0x1ebb1f['push'](_0x403b5e[_0x5f4c46]),_0x1ebb1f[_0x3c32b7(0x208)](_0x30323f[_0x324995]),_0x1ebb1f['push'](0x0);}}}_0x1ebb1f=new Float32Array(_0x1ebb1f);var _0x3a3dc2=0x6*_0x3266dd[_0x3c32b7(0x186)],_0x36a472=new Uint32Array(_0x3a3dc2);for(var _0x4e8369=0x0,_0x10189d=0x0,_0x5d1abf=0x0;_0x4e8369<_0x3266dd['maxParticles'];_0x4e8369++){_0x36a472[_0x10189d++]=_0x5d1abf+0x0,_0x36a472[_0x10189d++]=_0x5d1abf+0x1,_0x36a472[_0x10189d++]=_0x5d1abf+0x2,_0x36a472[_0x10189d++]=_0x5d1abf+0x2,_0x36a472[_0x10189d++]=_0x5d1abf+0x1,_0x36a472[_0x10189d++]=_0x5d1abf+0x3,_0x5d1abf+=0x4;}var _0x375412=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4[(_0x3c32b7(0x26b))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x12aae5}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x3c32b7(0x20d)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x1ebb1f})}),'indices':_0x36a472});return _0x375412;}},{'key':'createRenderingPrimitives','value':function _0xf2de17(_0x25dd74,_0x1017af,_0x17f5ad,_0x47eacb){var _0x2e6ffb=_0x3e945b,_0x3e0b62=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x1017af),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function _0x31a86b(){var _0x514be0=_0x9e68;return _0x47eacb['particlesTextures'][_0x514be0(0x270)];},'postProcessingPosition':function _0x3e8228(){var _0x2c4879=_0x9e68;return _0x47eacb[_0x2c4879(0x201)][_0x2c4879(0x1fb)];},'postProcessingSpeed':function _0x2273f5(){return _0x47eacb['particlesTextures']['postProcessingSpeed'];},'colorTable':function _0x58b2f1(){return _0x3e0b62['textures']['colorTable'];},'aspect':function _0x4c1ece(){return _0x25dd74['drawingBufferWidth']/_0x25dd74['drawingBufferHeight'];},'pixelSize':function _0xed4680(){var _0x2afb3c=_0x9e68;return _0x17f5ad[_0x2afb3c(0x1a5)];},'lineWidth':function _0x2c4d15(){return _0x1017af['lineWidth'];},'particleHeight':function _0x1046a2(){var _0x4935de=_0x9e68;return _0x1017af[_0x4935de(0x278)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0x2e6ffb(0x16f)][_0x2e6ffb(0x1e7)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x2e6ffb(0x175),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function _0x142e70(){var _0xedcd9c=_0x2e6ffb;return _0x3e0b62[_0xedcd9c(0x1e5)]['segmentsColor'];},'segmentsDepthTexture':function _0x2fcf08(){var _0x3e7ae9=_0x2e6ffb;return _0x3e0b62[_0x3e7ae9(0x1e5)]['segmentsDepth'];},'currentTrailsColor':function _0x27ceef(){var _0x45fb3d=_0x2e6ffb;return _0x3e0b62['framebuffers'][_0x45fb3d(0x1e6)]['getColorTexture'](0x0);},'trailsDepthTexture':function _0x21cb56(){return _0x3e0b62['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function _0x130ad8(){return _0x1017af['fadeOpacity'];}},'vertexShaderSource':new Cesium$4[(_0x2e6ffb(0x18f))]({'defines':[_0x2e6ffb(0x1cb)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x2e6ffb(0x18f))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x2e6ffb(0x18e)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0x2e6ffb(0x20a)]['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function _0x34e894(){var _0x4681f6=_0x2e6ffb,_0x2aec48=_0x3e0b62['framebuffers'][_0x4681f6(0x1e6)];_0x3e0b62[_0x4681f6(0x16f)][_0x4681f6(0x1e6)]=_0x3e0b62[_0x4681f6(0x16f)]['nextTrails'],_0x3e0b62['framebuffers']['nextTrails']=_0x2aec48,_0x3e0b62['primitives'][_0x4681f6(0x260)]['commandToExecute']['framebuffer']=_0x3e0b62['framebuffers']['nextTrails'],_0x3e0b62['primitives']['trails']['clearCommand']['framebuffer']=_0x3e0b62[_0x4681f6(0x16f)][_0x4681f6(0x1bf)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x2e6ffb(0x1f1)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function _0x465c3f(){return _0x3e0b62['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function _0x4b69e8(){var _0xb33837=_0x2e6ffb;return _0x3e0b62['framebuffers'][_0xb33837(0x1bf)]['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}]),_0xd80363;}()),getWind_frag=_0x2484ff(0x23d),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0avarying\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture2D(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture2D(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20nextSpeed;\x0a}',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0avarying\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture2D(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture2D(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0avarying\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture2D(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture2D(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0avarying\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture2D(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture2D(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}',Cesium$3=mars3d__namespace['Cesium'],ParticlesComputing=(function(){var _0x39c6bc=_0x2484ff;function _0x1f35a8(_0x497ce5,_0x297ef7,_0x1699ef,_0x5b4d69){var _0x35a6cd=_0x9e68;_classCallCheck(this,_0x1f35a8),this[_0x35a6cd(0x238)]=_0x297ef7,this['createWindTextures'](_0x497ce5,_0x297ef7),this[_0x35a6cd(0x1db)](_0x497ce5,_0x1699ef,_0x5b4d69),this['createComputingPrimitives'](_0x297ef7,_0x1699ef,_0x5b4d69);}return _createClass(_0x1f35a8,[{'key':'createWindTextures','value':function _0x31e8c4(_0x3345a0,_0x5110b0){var _0x144692=_0x9e68,_0xbd592d={'context':_0x3345a0,'width':_0x5110b0['dimensions'][_0x144692(0x19f)],'height':_0x5110b0['dimensions']['lat']*(_0x5110b0[_0x144692(0x1ab)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x144692(0x23e)]})};this[_0x144692(0x206)]={'U':Util['createTexture'](_0xbd592d,_0x5110b0['U']['array']),'V':Util['createTexture'](_0xbd592d,_0x5110b0['V']['array'])};}},{'key':'createParticlesTextures','value':function _0x19ec03(_0x45aa6f,_0x52230f,_0x116161){var _0x54c007=_0x9e68,_0x50b73b={'context':_0x45aa6f,'width':_0x52230f[_0x54c007(0x24e)],'height':_0x52230f['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3[_0x54c007(0x178)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x54c007(0x23e)],'magnificationFilter':Cesium$3[_0x54c007(0x26f)]['NEAREST']})},_0x15cb66=this['randomizeParticles'](_0x52230f['maxParticles'],_0x116161),_0x17e04b=new Float32Array(0x4*_0x52230f['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x50b73b),'currentParticlesPosition':Util[_0x54c007(0x1d2)](_0x50b73b,_0x15cb66),'nextParticlesPosition':Util['createTexture'](_0x50b73b,_0x15cb66),'currentParticlesSpeed':Util[_0x54c007(0x1d2)](_0x50b73b,_0x17e04b),'nextParticlesSpeed':Util['createTexture'](_0x50b73b,_0x17e04b),'postProcessingPosition':Util[_0x54c007(0x1d2)](_0x50b73b,_0x15cb66),'postProcessingSpeed':Util['createTexture'](_0x50b73b,_0x17e04b)};}},{'key':_0x39c6bc(0x179),'value':function _0x1ee000(_0x2f2f20,_0xc3691c){var _0x15b6cc=_0x39c6bc,_0x55b05a=new Float32Array(0x4*_0x2f2f20);for(var _0x160d3c=0x0;_0x160d3c<_0x2f2f20;_0x160d3c++){_0x55b05a[0x4*_0x160d3c]=Cesium$3['Math'][_0x15b6cc(0x1e4)](_0xc3691c['lonRange']['x'],_0xc3691c['lonRange']['y']),_0x55b05a[0x4*_0x160d3c+0x1]=Cesium$3['Math']['randomBetween'](_0xc3691c[_0x15b6cc(0x192)]['x'],_0xc3691c['latRange']['y']),_0x55b05a[0x4*_0x160d3c+0x2]=Cesium$3['Math'][_0x15b6cc(0x1e4)](this['data']['lev']['min'],this['data']['lev'][_0x15b6cc(0x1f2)]),_0x55b05a[0x4*_0x160d3c+0x3]=0x0;}return _0x55b05a;}},{'key':'destroyParticlesTextures','value':function _0x1cbf40(){var _0x38a065=_0x39c6bc,_0x34c14a=this;Object['keys'](this['particlesTextures'])[_0x38a065(0x25e)](function(_0x3389f5){var _0x2390a8=_0x38a065;_0x34c14a[_0x2390a8(0x201)][_0x3389f5]['destroy']();});}},{'key':'createComputingPrimitives','value':function _0x3d72e3(_0x1d999b,_0x1d5ab4,_0x55f0f3){var _0x469f28=_0x39c6bc,_0x21bedd=new Cesium$3['Cartesian3'](_0x1d999b['dimensions'][_0x469f28(0x19f)],_0x1d999b['dimensions']['lat'],_0x1d999b['dimensions']['lev']),_0x2e297f=new Cesium$3[(_0x469f28(0x1d4))](_0x1d999b[_0x469f28(0x19f)]['min'],_0x1d999b['lat']['min'],_0x1d999b[_0x469f28(0x219)]['min']),_0x5701af=new Cesium$3['Cartesian3'](_0x1d999b['lon']['max'],_0x1d999b['lat']['max'],_0x1d999b['lev'][_0x469f28(0x1f2)]),_0x42b304=new Cesium$3['Cartesian3']((_0x5701af['x']-_0x2e297f['x'])/(_0x21bedd['x']-0x1),(_0x5701af['y']-_0x2e297f['y'])/(_0x21bedd['y']-0x1),_0x21bedd['z']>0x1?(_0x5701af['z']-_0x2e297f['z'])/(_0x21bedd['z']-0x1):0x1),_0x120287=new Cesium$3['Cartesian2'](_0x1d999b['U']['min'],_0x1d999b['U']['max']),_0x5baf10=new Cesium$3[(_0x469f28(0x1a8))](_0x1d999b['V'][_0x469f28(0x23a)],_0x1d999b['V']['max']),_0x59a52f=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function _0x3a50dd(){return _0x59a52f['windTextures']['U'];},'V':function _0x3cdd2c(){return _0x59a52f['windTextures']['V'];},'currentParticlesPosition':function _0x2b818a(){return _0x59a52f['particlesTextures']['currentParticlesPosition'];},'dimension':function _0x489a74(){return _0x21bedd;},'minimum':function _0x8de4c0(){return _0x2e297f;},'maximum':function _0x3a59ef(){return _0x5701af;},'interval':function _0x133cd8(){return _0x42b304;}},'fragmentShaderSource':new Cesium$3[(_0x469f28(0x18f))]({'sources':[getWind_frag]}),'outputTexture':this[_0x469f28(0x201)]['particlesWind'],'preExecute':function _0x425f17(){var _0x101054=_0x469f28;_0x59a52f[_0x101054(0x189)]['getWind']['commandToExecute']['outputTexture']=_0x59a52f['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function _0x5e1c40(){var _0x1675ef=_0x469f28;return _0x59a52f['particlesTextures'][_0x1675ef(0x181)];},'particlesWind':function _0xfb348e(){return _0x59a52f['particlesTextures']['particlesWind'];},'uSpeedRange':function _0x46e9fb(){return _0x120287;},'vSpeedRange':function _0x17d227(){return _0x5baf10;},'pixelSize':function _0x476f22(){var _0x3e95a6=_0x469f28;return _0x55f0f3[_0x3e95a6(0x1a5)];},'speedFactor':function _0x23fa88(){var _0x2676d4=_0x469f28;return _0x1d5ab4[_0x2676d4(0x1d9)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function _0x3f9f88(){var _0x2aa276=_0x469f28,_0x33b104=_0x59a52f['particlesTextures']['currentParticlesSpeed'];_0x59a52f[_0x2aa276(0x201)]['currentParticlesSpeed']=_0x59a52f[_0x2aa276(0x201)]['postProcessingSpeed'],_0x59a52f[_0x2aa276(0x201)]['postProcessingSpeed']=_0x33b104,_0x59a52f[_0x2aa276(0x189)]['updateSpeed']['commandToExecute']['outputTexture']=_0x59a52f['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function _0x700271(){var _0x52faeb=_0x469f28;return _0x59a52f[_0x52faeb(0x201)]['currentParticlesPosition'];},'currentParticlesSpeed':function _0x4b9311(){return _0x59a52f['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0x469f28(0x201)]['nextParticlesPosition'],'preExecute':function _0x585397(){var _0xbf2401=_0x469f28,_0x129bca=_0x59a52f['particlesTextures']['currentParticlesPosition'];_0x59a52f[_0xbf2401(0x201)]['currentParticlesPosition']=_0x59a52f['particlesTextures']['postProcessingPosition'],_0x59a52f['particlesTextures']['postProcessingPosition']=_0x129bca,_0x59a52f[_0xbf2401(0x189)]['updatePosition'][_0xbf2401(0x209)]['outputTexture']=_0x59a52f['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function _0x359148(){var _0x236ea5=_0x469f28;return _0x59a52f[_0x236ea5(0x201)][_0x236ea5(0x177)];},'nextParticlesSpeed':function _0x3cfb9a(){return _0x59a52f['particlesTextures']['nextParticlesSpeed'];},'lonRange':function _0x45eee9(){return _0x55f0f3['lonRange'];},'latRange':function _0x104f22(){return _0x55f0f3['latRange'];},'randomCoefficient':function _0x2175b3(){var _0x5744e4=_0x469f28,_0x38f6bd=Math[_0x5744e4(0x188)]();return _0x38f6bd;},'dropRate':function _0x451858(){var _0x4bf2c2=_0x469f28;return _0x1d5ab4[_0x4bf2c2(0x180)];},'dropRateBump':function _0x3228a4(){return _0x1d5ab4['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x469f28(0x18f))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function _0x520999(){var _0x3e9cd8=_0x469f28;_0x59a52f['primitives']['postProcessingPosition']['commandToExecute'][_0x3e9cd8(0x1d1)]=_0x59a52f['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function _0x11e38a(){return _0x59a52f['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function _0x57778c(){var _0x569b0a=_0x469f28;return _0x59a52f['particlesTextures'][_0x569b0a(0x257)];}},'fragmentShaderSource':new Cesium$3[(_0x469f28(0x18f))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x469f28(0x1ef)],'preExecute':function _0x1e6354(){var _0x52fd70=_0x469f28;_0x59a52f[_0x52fd70(0x189)]['postProcessingSpeed'][_0x52fd70(0x209)]['outputTexture']=_0x59a52f['particlesTextures']['postProcessingSpeed'];}})};}}]),_0x1f35a8;}()),Cesium$2=mars3d__namespace['Cesium'],ParticleSystem=(function(){var _0x53a966=_0x2484ff;function _0x534065(_0x163a11,_0x1c9a91,_0x59b598,_0x589755){var _0x1dae79=_0x9e68;_classCallCheck(this,_0x534065),this['context']=_0x163a11,_0x1c9a91=_objectSpread2({},_0x1c9a91);if(_0x1c9a91['udata']&&_0x1c9a91['vdata']){var _0x5c9fc0,_0x2f9608,_0x2194eb,_0x10e41c,_0x29a456,_0x25b3e2;_0x1c9a91['dimensions']={},_0x1c9a91[_0x1dae79(0x1ab)]['lon']=_0x1c9a91['cols'],_0x1c9a91['dimensions']['lat']=_0x1c9a91['rows'],_0x1c9a91[_0x1dae79(0x1ab)][_0x1dae79(0x219)]=_0x1c9a91['lev']||0x1,_0x1c9a91['lon']={},_0x1c9a91['lon']['min']=_0x1c9a91[_0x1dae79(0x24d)],_0x1c9a91[_0x1dae79(0x19f)]['max']=_0x1c9a91['xmax'],_0x1c9a91['lat']={},_0x1c9a91['lat'][_0x1dae79(0x23a)]=_0x1c9a91[_0x1dae79(0x267)],_0x1c9a91[_0x1dae79(0x17b)][_0x1dae79(0x1f2)]=_0x1c9a91['ymax'],_0x1c9a91[_0x1dae79(0x219)]={},_0x1c9a91['lev']['min']=(_0x5c9fc0=_0x1c9a91[_0x1dae79(0x190)])!==null&&_0x5c9fc0!==void 0x0?_0x5c9fc0:0x1,_0x1c9a91['lev']['max']=(_0x2f9608=_0x1c9a91['levmax'])!==null&&_0x2f9608!==void 0x0?_0x2f9608:0x1,_0x1c9a91['U']={},_0x1c9a91['U']['array']=new Float32Array(_0x1c9a91['udata']),_0x1c9a91['U']['min']=(_0x2194eb=_0x1c9a91[_0x1dae79(0x215)])!==null&&_0x2194eb!==void 0x0?_0x2194eb:Math['min']['apply'](Math,_toConsumableArray(_0x1c9a91[_0x1dae79(0x1b7)])),_0x1c9a91['U']['max']=(_0x10e41c=_0x1c9a91[_0x1dae79(0x1e3)])!==null&&_0x10e41c!==void 0x0?_0x10e41c:Math['max']['apply'](Math,_toConsumableArray(_0x1c9a91[_0x1dae79(0x1b7)])),_0x1c9a91['V']={},_0x1c9a91['V']['array']=new Float32Array(_0x1c9a91['vdata']),_0x1c9a91['V'][_0x1dae79(0x23a)]=(_0x29a456=_0x1c9a91['vmin'])!==null&&_0x29a456!==void 0x0?_0x29a456:Math['min'][_0x1dae79(0x1a4)](Math,_toConsumableArray(_0x1c9a91['vdata'])),_0x1c9a91['V'][_0x1dae79(0x1f2)]=(_0x25b3e2=_0x1c9a91[_0x1dae79(0x1b5)])!==null&&_0x25b3e2!==void 0x0?_0x25b3e2:Math[_0x1dae79(0x1f2)]['apply'](Math,_toConsumableArray(_0x1c9a91[_0x1dae79(0x1c8)]));}this[_0x1dae79(0x238)]=_0x1c9a91,this[_0x1dae79(0x1da)]=_0x59b598,this[_0x1dae79(0x263)]=_0x589755,this['particlesComputing']=new ParticlesComputing(this[_0x1dae79(0x17d)],this[_0x1dae79(0x238)],this[_0x1dae79(0x1da)],this['viewerParameters']),this[_0x1dae79(0x221)]=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this[_0x1dae79(0x1e1)]);}return _createClass(_0x534065,[{'key':_0x53a966(0x1bd),'value':function _0x58a783(_0x9717d4){var _0x4fd21d=_0x53a966,_0x22f172=this;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])[_0x4fd21d(0x25e)](function(_0x6873ee){_0x22f172['particlesComputing']['windTextures'][_0x6873ee]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object[_0x4fd21d(0x1ad)](this[_0x4fd21d(0x221)]['framebuffers'])[_0x4fd21d(0x25e)](function(_0xdd371b){var _0x13e093=_0x4fd21d;_0x22f172[_0x13e093(0x221)]['framebuffers'][_0xdd371b][_0x13e093(0x1a0)]();}),this[_0x4fd21d(0x17d)]=_0x9717d4,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this[_0x4fd21d(0x221)]=new ParticlesRendering(this['context'],this['data'],this[_0x4fd21d(0x1da)],this['viewerParameters'],this['particlesComputing']);}},{'key':'clearFramebuffers','value':function _0x10f4a5(){var _0x135a51=_0x53a966,_0x371878=this,_0x972185=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x135a51(0x1b2)]});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](function(_0x59bbb6){var _0xf44267=_0x135a51;_0x972185[_0xf44267(0x1dd)]=_0x371878['particlesRendering']['framebuffers'][_0x59bbb6],_0x972185['execute'](_0x371878['context']);});}},{'key':'refreshParticles','value':function _0x16ad99(_0x35d60f){var _0xe0144e=_0x53a966;this['clearFramebuffers'](),this[_0xe0144e(0x1e1)][_0xe0144e(0x1ae)](),this['particlesComputing']['createParticlesTextures'](this['context'],this['options'],this[_0xe0144e(0x263)]);if(_0x35d60f){var _0x25a74b=this[_0xe0144e(0x221)]['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments']['geometry']=_0x25a74b;var _0x45aecc=Cesium$2[_0xe0144e(0x256)]['fromGeometry']({'context':this['context'],'geometry':_0x25a74b,'attributeLocations':this['particlesRendering']['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x45aecc;}}},{'key':'setOptions','value':function _0x5e034b(_0x54eb54){var _0x1eabd1=_0x53a966,_0xfb17f1=this,_0x2ba381=![];this['options'][_0x1eabd1(0x186)]!==_0x54eb54['maxParticles']&&(_0x2ba381=!![]),Object['keys'](_0x54eb54)[_0x1eabd1(0x25e)](function(_0x17c3e3){_0xfb17f1['options'][_0x17c3e3]=_0x54eb54[_0x17c3e3];}),this[_0x1eabd1(0x1f6)](_0x2ba381);}},{'key':_0x53a966(0x193),'value':function _0x19b930(_0x3c6db8){var _0x5e4a91=this;Object['keys'](_0x3c6db8)['forEach'](function(_0x4849e2){_0x5e4a91['viewerParameters'][_0x4849e2]=_0x3c6db8[_0x4849e2];}),this['refreshParticles'](![]);}},{'key':'destroy','value':function _0x1a0714(){var _0x2f82cc=_0x53a966,_0x554549=this;clearTimeout(this['canrefresh']),this['particlesComputing'][_0x2f82cc(0x1ae)](),Object['keys'](this[_0x2f82cc(0x1e1)]['windTextures'])['forEach'](function(_0xd9c873){var _0x20db90=_0x2f82cc;_0x554549['particlesComputing'][_0x20db90(0x206)][_0xd9c873]['destroy']();}),this[_0x2f82cc(0x221)]['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](function(_0x2f0f5f){_0x554549['particlesRendering']['framebuffers'][_0x2f0f5f]['destroy']();});for(var _0x1d09c6 in this){delete this[_0x1d09c6];}}}]),_0x534065;}()),Cesium$1=mars3d__namespace[_0x2484ff(0x207)],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x2484ff(0x1b8)]},WindLayer=function(_0x3f86ee){var _0x345b1c=_0x2484ff;_inherits(_0x445889,_0x3f86ee);var _0x47b66f=_createSuper(_0x445889);function _0x445889(){var _0x2e2443,_0x4243d3=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0x445889),_0x4243d3=_objectSpread2(_objectSpread2({},DEF_OPTIONS),_0x4243d3),_0x2e2443=_0x47b66f['call'](this,_0x4243d3),_0x2e2443['_setOptionsHook'](_0x4243d3),_0x2e2443;}return _createClass(_0x445889,[{'key':_0x345b1c(0x272),'get':function _0x174fcf(){var _0x496219=_0x345b1c;return this[_0x496219(0x189)];}},{'key':_0x345b1c(0x238),'get':function _0x14eadb(){var _0x180fbd=_0x345b1c;return this[_0x180fbd(0x262)];},'set':function _0x1c50a4(_0x346bf3){this['setData'](_0x346bf3);}},{'key':'colors','get':function _0x412ed3(){return this['options']['colors'];},'set':function _0x199eae(_0x4d408e){var _0x564fec=_0x345b1c;this['options']['colors']=_0x4d408e,this['particleSystem']&&this[_0x564fec(0x20c)]['setOptions']({'colors':_0x4d408e}),this[_0x564fec(0x1aa)]();}},{'key':'_mountedHook','value':function _0x2ec273(){}},{'key':_0x345b1c(0x1fa),'value':function _0xed0e5d(){var _0x400e9a=_0x345b1c;this[_0x400e9a(0x265)]=this['_map']['scene'],this['camera']=this['_map'][_0x400e9a(0x224)],this[_0x400e9a(0x189)]=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this[_0x400e9a(0x189)]),this[_0x400e9a(0x263)]={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x400e9a(0x1f0)]=new Cesium$1['BoundingSphere'](Cesium$1[_0x400e9a(0x1d4)]['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window[_0x400e9a(0x1ce)](_0x400e9a(0x1aa),this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x400e9a(0x1c4)]['on'](mars3d__namespace['EventType'][_0x400e9a(0x1e9)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x400e9a(0x1a3)][_0x400e9a(0x1d8)],this['_onMouseDownEvent'],this),this[_0x400e9a(0x1c4)]['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x400e9a(0x1c5)],this),this[_0x400e9a(0x1c4)]['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}},{'key':'_removedHook','value':function _0x45cde8(){var _0x510cf5=_0x345b1c;window['removeEventListener'](_0x510cf5(0x1aa),this[_0x510cf5(0x1aa)]),this[_0x510cf5(0x1c4)][_0x510cf5(0x23f)](mars3d__namespace['EventType']['preRender'],this[_0x510cf5(0x21f)],this),this[_0x510cf5(0x1c4)]['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x510cf5(0x1d8)],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x510cf5(0x189)][_0x510cf5(0x1cf)](),this['_map'][_0x510cf5(0x265)][_0x510cf5(0x189)][_0x510cf5(0x242)](this[_0x510cf5(0x189)]);}},{'key':_0x345b1c(0x1aa),'value':function _0x156464(){var _0x223bf1=_0x345b1c;if(!this['show']||!this[_0x223bf1(0x20c)])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this[_0x223bf1(0x1c4)]['once'](mars3d__namespace['EventType'][_0x223bf1(0x22a)],this[_0x223bf1(0x21f)],this);}},{'key':'_onMap_preRenderEvent','value':function _0x5f063f(_0x4dfa92){var _0x109107=_0x345b1c;this['particleSystem']['canvasResize'](this['scene']['context']),this['addPrimitives'](),this[_0x109107(0x189)]['show']=!![];}},{'key':'_onMapWhellEvent','value':function _0x519770(_0x48febb){var _0x88e5a3=_0x345b1c,_0x23c82e=this;clearTimeout(this[_0x88e5a3(0x1fc)]);if(!this[_0x88e5a3(0x254)]||!this[_0x88e5a3(0x20c)])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(function(){if(!_0x23c82e['show'])return;_0x23c82e['redraw']();},0xc8);}},{'key':'_onMouseDownEvent','value':function _0x4a7c47(_0x51f0b2){this['mouse_down']=!![];}},{'key':_0x345b1c(0x22b),'value':function _0x36ae5b(_0x551e1e){var _0x3cbe83=_0x345b1c;if(!this['show']||!this[_0x3cbe83(0x20c)])return;this['mouse_down']&&(this['primitives'][_0x3cbe83(0x254)]=![],this['mouse_move']=!![]);}},{'key':'_onMouseUpEvent','value':function _0x3933a4(_0x2e9485){var _0x41e569=_0x345b1c;if(!this['show']||!this[_0x41e569(0x20c)])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this[_0x41e569(0x1dc)]=![];}},{'key':_0x345b1c(0x211),'value':function _0x1442a5(){var _0x5975b9=_0x345b1c;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this[_0x5975b9(0x20c)][_0x5975b9(0x193)](this['viewerParameters']),this['primitives']['show']=!![];}},{'key':'setData','value':function _0x646b60(_0x23607e){var _0x22c506=_0x345b1c;this['_data']=_0x23607e,this['particleSystem']&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene'][_0x22c506(0x17d)],_0x23607e,this['getOptions'](),this['viewerParameters']),this[_0x22c506(0x24f)]();}},{'key':'_setOptionsHook','value':function _0x32fb9e(_0x5a6890,_0x577119){var _0x42214d=_0x345b1c;if(_0x5a6890)for(var _0x5dcbf3 in _0x5a6890){this[_0x5dcbf3]=_0x5a6890[_0x5dcbf3];}this['particleSystem']&&this['particleSystem'][_0x42214d(0x18c)](this[_0x42214d(0x1b0)]());}},{'key':'getOptions','value':function _0x1d1ae2(){var _0x392c14=_0x345b1c,_0x496b75=Math['ceil'](Math[_0x392c14(0x269)](this[_0x392c14(0x23b)]));return this['particlesNumber']=_0x496b75*_0x496b75,{'particlesTextureSize':_0x496b75,'maxParticles':this['particlesNumber'],'particleHeight':this[_0x392c14(0x1be)],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this[_0x392c14(0x1f9)],'colors':this['colors']};}},{'key':'addPrimitives','value':function _0x2c3368(){var _0x1441a0=_0x345b1c;this[_0x1441a0(0x189)]['add'](this['particleSystem']['particlesComputing']['primitives']['getWind']),this[_0x1441a0(0x189)]['add'](this['particleSystem'][_0x1441a0(0x1e1)]['primitives']['updateSpeed']),this['primitives'][_0x1441a0(0x197)](this[_0x1441a0(0x20c)]['particlesComputing']['primitives'][_0x1441a0(0x17c)]),this[_0x1441a0(0x189)]['add'](this['particleSystem'][_0x1441a0(0x1e1)][_0x1441a0(0x189)][_0x1441a0(0x1fb)]),this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x1441a0(0x189)][_0x1441a0(0x1ef)]),this[_0x1441a0(0x189)]['add'](this['particleSystem']['particlesRendering'][_0x1441a0(0x189)][_0x1441a0(0x1e7)]),this['primitives'][_0x1441a0(0x197)](this[_0x1441a0(0x20c)][_0x1441a0(0x221)]['primitives']['trails']),this['primitives'][_0x1441a0(0x197)](this['particleSystem'][_0x1441a0(0x221)]['primitives']['screen']);}},{'key':_0x345b1c(0x1c3),'value':function _0x196a86(){var _0x2a6336=_0x345b1c,_0x153f8c=this['camera']['computeViewRectangle'](this[_0x2a6336(0x265)]['globe']['ellipsoid']);if(!_0x153f8c){var _0x30103a=this[_0x2a6336(0x1c4)]['getExtent']();_0x153f8c=Cesium$1['Rectangle']['fromDegrees'](_0x30103a['xmin'],_0x30103a[_0x2a6336(0x267)],_0x30103a['xmax'],_0x30103a['ymax']);}var _0x42822b=Util[_0x2a6336(0x1ed)](_0x153f8c);this['viewerParameters']['lonRange']['x']=_0x42822b[_0x2a6336(0x19f)]['min'],this['viewerParameters']['lonRange']['y']=_0x42822b[_0x2a6336(0x19f)]['max'],this['viewerParameters']['latRange']['x']=_0x42822b[_0x2a6336(0x17b)]['min'],this[_0x2a6336(0x263)]['latRange']['y']=_0x42822b[_0x2a6336(0x17b)]['max'];var _0x53e7d2=this['camera'][_0x2a6336(0x1fd)](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x53e7d2>0x0&&(this[_0x2a6336(0x263)]['pixelSize']=_0x53e7d2);}}]),_0x445889;}(BaseLayer$1);mars3d__namespace['LayerUtil'][_0x2484ff(0x1af)]('wind',WindLayer),mars3d__namespace[_0x2484ff(0x272)]['WindLayer']=WindLayer;var CanvasParticle=(function(){function _0x3d9af8(){var _0x99276=_0x9e68;_classCallCheck(this,_0x3d9af8),this['lng']=null,this['lat']=null,this['tlng']=null,this[_0x99276(0x1b9)]=null,this['age']=null;}return _createClass(_0x3d9af8,[{'key':'destroy','value':function _0x47a24c(){for(var _0x386c48 in this){delete this[_0x386c48];}}}]),_0x3d9af8;}()),CanvasWindField=(function(){var _0x37b00f=_0x2484ff;function _0x2e329f(_0x39ed7f){_classCallCheck(this,_0x2e329f),this['setOptions'](_0x39ed7f);}return _createClass(_0x2e329f,[{'key':_0x37b00f(0x1ff),'get':function _0x52ad27(){var _0x24a54b=_0x37b00f;return this[_0x24a54b(0x1de)];},'set':function _0x47566(_0x243242){var _0x3fb204=_0x37b00f;this['_speedRate']=(0x64-(_0x243242>0x63?0x63:_0x243242))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this['_speedRate'],(this[_0x3fb204(0x22d)]-this[_0x3fb204(0x267)])/this['_speedRate']];}},{'key':'maxAge','get':function _0x565849(){return this['_maxAge'];},'set':function _0x5dd705(_0x159705){this['_maxAge']=_0x159705;}},{'key':'setOptions','value':function _0x21f41f(_0x2815cb){var _0xbdbd18=_0x37b00f;this[_0xbdbd18(0x1da)]=_0x2815cb,this[_0xbdbd18(0x258)]=_0x2815cb['maxAge']||0x78,this['speedRate']=_0x2815cb[_0xbdbd18(0x1ff)]||0x32,this['particles']=[];var _0x206ce1=_0x2815cb['particlesNumber']||0x1000;for(var _0x2dbf69=0x0;_0x2dbf69<_0x206ce1;_0x2dbf69++){var _0x121a5e=this[_0xbdbd18(0x1c2)](new CanvasParticle());this[_0xbdbd18(0x18d)]['push'](_0x121a5e);}}},{'key':_0x37b00f(0x220),'value':function _0x41c099(_0x4ad435){var _0x5b6ea4=_0x37b00f;this['rows']=_0x4ad435['rows'],this[_0x5b6ea4(0x1b4)]=_0x4ad435['cols'],this['xmin']=_0x4ad435['xmin'],this['xmax']=_0x4ad435['xmax'],this[_0x5b6ea4(0x267)]=_0x4ad435[_0x5b6ea4(0x267)],this['ymax']=_0x4ad435[_0x5b6ea4(0x22d)],this['grid']=[];var _0x3b84f4=_0x4ad435['udata'],_0x3aa333=_0x4ad435['vdata'],_0x3004bc=![];_0x3b84f4[_0x5b6ea4(0x20e)]===this['rows']&&_0x3b84f4[0x0][_0x5b6ea4(0x20e)]===this['cols']&&(_0x3004bc=!![]);var _0x48a9e5=0x0,_0x1432c8=null,_0x1b217b=null;for(var _0xe6f8c6=0x0;_0xe6f8c6<this[_0x5b6ea4(0x229)];_0xe6f8c6++){_0x1432c8=[];for(var _0x3bf16f=0x0;_0x3bf16f<this['cols'];_0x3bf16f++,_0x48a9e5++){_0x3004bc?_0x1b217b=this['_calcUV'](_0x3b84f4[_0xe6f8c6][_0x3bf16f],_0x3aa333[_0xe6f8c6][_0x3bf16f]):_0x1b217b=this['_calcUV'](_0x3b84f4[_0x48a9e5],_0x3aa333[_0x48a9e5]),_0x1432c8[_0x5b6ea4(0x208)](_0x1b217b);}this[_0x5b6ea4(0x200)][_0x5b6ea4(0x208)](_0x1432c8);}this['options'][_0x5b6ea4(0x174)]&&this['grid'][_0x5b6ea4(0x259)]();}},{'key':_0x37b00f(0x233),'value':function _0x2c6b85(){var _0x2724bb=_0x37b00f;delete this[_0x2724bb(0x229)],delete this['cols'],delete this[_0x2724bb(0x24d)],delete this['xmax'],delete this['ymin'],delete this[_0x2724bb(0x22d)],delete this['grid'],delete this['particles'];}},{'key':_0x37b00f(0x1a9),'value':function _0x39aa28(_0x9811be,_0x2caebb){var _0xb62e98=_0x37b00f,_0x4b5f0d=(_0x9811be-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x354579=(this['ymax']-_0x2caebb)/(this['ymax']-this[_0xb62e98(0x267)])*(this['rows']-0x1);return[_0x4b5f0d,_0x354579];}},{'key':'getUVByXY','value':function _0x285aff(_0x325589,_0x1df81f){var _0x2ed54d=_0x37b00f;if(_0x325589<0x0||_0x325589>=this['cols']||_0x1df81f>=this['rows'])return[0x0,0x0,0x0];var _0x3bb11c=Math['floor'](_0x325589),_0x267d75=Math['floor'](_0x1df81f);if(_0x3bb11c===_0x325589&&_0x267d75===_0x1df81f)return this[_0x2ed54d(0x200)][_0x1df81f][_0x325589];var _0x479077=_0x3bb11c+0x1,_0x54456d=_0x267d75+0x1,_0x546e44=this['getUVByXY'](_0x3bb11c,_0x267d75),_0x55fe1b=this['getUVByXY'](_0x479077,_0x267d75),_0x155ad2=this['getUVByXY'](_0x3bb11c,_0x54456d),_0x7932fd=this[_0x2ed54d(0x204)](_0x479077,_0x54456d),_0x2bb4c3=null;try{_0x2bb4c3=this['_bilinearInterpolation'](_0x325589-_0x3bb11c,_0x1df81f-_0x267d75,_0x546e44,_0x55fe1b,_0x155ad2,_0x7932fd);}catch(_0x4189ce){console[_0x2ed54d(0x241)](_0x325589,_0x1df81f);}return _0x2bb4c3;}},{'key':'_bilinearInterpolation','value':function _0x308e12(_0x169efa,_0x51b3a1,_0x1b886b,_0x4002e3,_0x28fc16,_0x4434b9){var _0x3f69af=0x1-_0x169efa,_0x142094=0x1-_0x51b3a1,_0x136df3=_0x3f69af*_0x142094,_0x33fd73=_0x169efa*_0x142094,_0x471b2b=_0x3f69af*_0x51b3a1,_0x5a2d56=_0x169efa*_0x51b3a1,_0x3f9f9a=_0x1b886b[0x0]*_0x136df3+_0x4002e3[0x0]*_0x33fd73+_0x28fc16[0x0]*_0x471b2b+_0x4434b9[0x0]*_0x5a2d56,_0x3b6f09=_0x1b886b[0x1]*_0x136df3+_0x4002e3[0x1]*_0x33fd73+_0x28fc16[0x1]*_0x471b2b+_0x4434b9[0x1]*_0x5a2d56;return this['_calcUV'](_0x3f9f9a,_0x3b6f09);}},{'key':'_calcUV','value':function _0xb6294c(_0x28dee1,_0x3df17b){var _0x328d91=_0x37b00f;return[+_0x28dee1,+_0x3df17b,Math[_0x328d91(0x269)](_0x28dee1*_0x28dee1+_0x3df17b*_0x3df17b)];}},{'key':'getUVByPoint','value':function _0x1c3e86(_0x11a568,_0x389fc7){var _0x342b34=_0x37b00f;if(!this['isInExtent'](_0x11a568,_0x389fc7))return null;var _0x527475=this[_0x342b34(0x1a9)](_0x11a568,_0x389fc7),_0x256fea=this[_0x342b34(0x204)](_0x527475[0x0],_0x527475[0x1]);return _0x256fea;}},{'key':'isInExtent','value':function _0x1c0d35(_0x568bfc,_0x2c87c1){return _0x568bfc>=this['xmin']&&_0x568bfc<=this['xmax']&&_0x2c87c1>=this['ymin']&&_0x2c87c1<=this['ymax']?!![]:![];}},{'key':'getRandomLatLng','value':function _0x7aaba3(){var _0x145916=_0x37b00f,_0x5706a8=fRandomByfloat(this['xmin'],this['xmax']),_0x1b5729=fRandomByfloat(this[_0x145916(0x267)],this['ymax']);return{'lat':_0x1b5729,'lng':_0x5706a8};}},{'key':'getParticles','value':function _0x20d736(){var _0x5a6907=_0x37b00f,_0x597ff7,_0x3cefe5,_0x5e7c49;for(var _0x6c32a2=0x0,_0x753964=this['particles'][_0x5a6907(0x20e)];_0x6c32a2<_0x753964;_0x6c32a2++){var _0x1790fb=this['particles'][_0x6c32a2];_0x1790fb['age']<=0x0&&(_0x1790fb=this[_0x5a6907(0x1c2)](_0x1790fb));if(_0x1790fb['age']>0x0){var _0x53d820=_0x1790fb['tlng'],_0x108fe8=_0x1790fb[_0x5a6907(0x1b9)];_0x5e7c49=this[_0x5a6907(0x1a1)](_0x53d820,_0x108fe8),_0x5e7c49?(_0x597ff7=_0x53d820+this['_calc_speedRate'][0x0]*_0x5e7c49[0x0],_0x3cefe5=_0x108fe8+this['_calc_speedRate'][0x1]*_0x5e7c49[0x1],_0x1790fb['lng']=_0x53d820,_0x1790fb['lat']=_0x108fe8,_0x1790fb[_0x5a6907(0x1d7)]=_0x597ff7,_0x1790fb['tlat']=_0x3cefe5,_0x1790fb['age']--):_0x1790fb['age']=0x0;}}return this['particles'];}},{'key':'_randomParticle','value':function _0x2cc17f(_0x2a1243){var _0x5c07fe=_0x37b00f,_0x1ad61e,_0x1ffd74;for(var _0x4538f7=0x0;_0x4538f7<0x1e;_0x4538f7++){_0x1ad61e=this['getRandomLatLng'](),_0x1ffd74=this[_0x5c07fe(0x1a1)](_0x1ad61e[_0x5c07fe(0x1c0)],_0x1ad61e[_0x5c07fe(0x17b)]);if(_0x1ffd74&&_0x1ffd74[0x2]>0x0)break;}if(!_0x1ffd74)return _0x2a1243;var _0x4a283c=_0x1ad61e['lng']+this[_0x5c07fe(0x1d6)][0x0]*_0x1ffd74[0x0],_0xb07b25=_0x1ad61e['lat']+this['_calc_speedRate'][0x1]*_0x1ffd74[0x1];return _0x2a1243['lng']=_0x1ad61e['lng'],_0x2a1243['lat']=_0x1ad61e['lat'],_0x2a1243['tlng']=_0x4a283c,_0x2a1243['tlat']=_0xb07b25,_0x2a1243['age']=Math['round'](Math['random']()*this['maxAge']),_0x2a1243;}},{'key':_0x37b00f(0x1a0),'value':function _0x5301f7(){for(var _0x23b856 in this){delete this[_0x23b856];}}}]),_0x2e329f;}());function fRandomByfloat(_0x50fa5c,_0x5e9bd7){return _0x50fa5c+Math['random']()*(_0x5e9bd7-_0x50fa5c);}var Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'],CanvasWindLayer=function(_0x4ff2a5){var _0x27212d=_0x2484ff;_inherits(_0xabb2b1,_0x4ff2a5);var _0x27a168=_createSuper(_0xabb2b1);function _0xabb2b1(){var _0x1ae523=_0x9e68,_0x551a1e,_0x58aa0a=arguments[_0x1ae523(0x20e)]>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0xabb2b1),_0x551a1e=_0x27a168['call'](this,_0x58aa0a),_0x551a1e['_setOptionsHook'](_0x58aa0a),_0x551a1e['canvas']=null,_0x551a1e;}return _createClass(_0xabb2b1,[{'key':_0x27212d(0x1c6),'value':function _0x46cdef(_0x464cd4,_0x2161ef){var _0x31f332=_0x27212d,_0x2c1253,_0x50aebd,_0x4a7e5c;this['frameTime']=0x3e8/(_0x464cd4['frameRate']||0xa),this['_pointerEvents']=(_0x2c1253=this['options'][_0x31f332(0x24c)])!==null&&_0x2c1253!==void 0x0?_0x2c1253:![],this['color']=_0x464cd4['color']||_0x31f332(0x274),this['lineWidth']=_0x464cd4['lineWidth']||0x1,this['fixedHeight']=(_0x50aebd=_0x464cd4['fixedHeight'])!==null&&_0x50aebd!==void 0x0?_0x50aebd:0x0,this['reverseY']=(_0x4a7e5c=_0x464cd4[_0x31f332(0x174)])!==null&&_0x4a7e5c!==void 0x0?_0x4a7e5c:![],this['windField']&&this['windField'][_0x31f332(0x18c)](_0x464cd4);}},{'key':'layer','get':function _0x354a0e(){return this['canvas'];}},{'key':'canvasWidth','get':function _0x18ed67(){var _0x3c8d49=_0x27212d;return this[_0x3c8d49(0x1c4)][_0x3c8d49(0x265)]['canvas']['clientWidth'];}},{'key':'canvasHeight','get':function _0x1b978c(){var _0x23e5ac=_0x27212d;return this[_0x23e5ac(0x1c4)][_0x23e5ac(0x265)]['canvas']['clientHeight'];}},{'key':'pointerEvents','get':function _0x3695f9(){return this['_pointerEvents'];},'set':function _0xe2ae78(_0x1ed2f1){var _0x4622ca=_0x27212d;this['_pointerEvents']=_0x1ed2f1;if(!this['canvas'])return;_0x1ed2f1?this['canvas'][_0x4622ca(0x1b1)][_0x4622ca(0x261)]='all':this['canvas'][_0x4622ca(0x1b1)]['pointer-events']='none';}},{'key':'particlesNumber','get':function _0xf96765(){var _0x423ea0=_0x27212d;return this['options'][_0x423ea0(0x23b)];},'set':function _0x3ea96f(_0xe60144){var _0x2f4af9=this;this['options']['particlesNumber']=_0xe60144,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(function(){var _0x5a9d21=_0x9e68;_0x2f4af9[_0x5a9d21(0x211)]();},0x1f4);}},{'key':'speedRate','get':function _0x56b55a(){var _0x3d6dfb=_0x27212d;return this['options'][_0x3d6dfb(0x1ff)];},'set':function _0x5f138f(_0x209751){var _0x2f233c=_0x27212d;this['options']['speedRate']=_0x209751,this['windField']&&(this[_0x2f233c(0x1f3)]['speedRate']=_0x209751);}},{'key':'maxAge','get':function _0x36cd7e(){return this['options']['maxAge'];},'set':function _0xb134b4(_0x35d3fa){var _0x41dcbd=_0x27212d;this['options']['maxAge']=_0x35d3fa,this[_0x41dcbd(0x1f3)]&&(this[_0x41dcbd(0x1f3)]['maxAge']=_0x35d3fa);}},{'key':'data','get':function _0x1a5dae(){return this['windData'];},'set':function _0x1eda98(_0x32570b){var _0x3e3fec=_0x27212d;this[_0x3e3fec(0x226)](_0x32570b);}},{'key':_0x27212d(0x240),'value':function _0x281258(_0x5a1134){var _0x5a1574=_0x27212d;_0x5a1134?this[_0x5a1574(0x1fa)]():(this['windData']&&(this['options']['data']=this[_0x5a1574(0x214)]),this['_removedHook']());}},{'key':_0x27212d(0x255),'value':function _0x14378c(){var _0x15a33f=_0x27212d;this['options']['worker']?this[_0x15a33f(0x1ea)]():this[_0x15a33f(0x1f3)]=new CanvasWindField(this['options']);}},{'key':'_addedHook','value':function _0x2b9cba(){var _0x565700=_0x27212d;this[_0x565700(0x202)]=this['_createCanvas'](),this[_0x565700(0x22e)]=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this[_0x565700(0x1e0)](),this['options']['data']&&this['setData'](this[_0x565700(0x1da)]['data']);}},{'key':_0x27212d(0x1d0),'value':function _0x1aaedf(){var _0x4c8381=_0x27212d;this[_0x4c8381(0x233)](),this['unbindEvent'](),this[_0x4c8381(0x202)]&&(this['_map']['container'][_0x4c8381(0x171)](this['canvas']),delete this['canvas']);}},{'key':_0x27212d(0x170),'value':function _0x23406d(){var _0x5ddb2a=_0x27212d,_0x4580c1=document['createElement'](_0x5ddb2a(0x202));_0x4580c1[_0x5ddb2a(0x1b1)]['position']=_0x5ddb2a(0x25f),_0x4580c1['style']['top']='0px',_0x4580c1['style'][_0x5ddb2a(0x1f8)]=_0x5ddb2a(0x1ba),_0x4580c1[_0x5ddb2a(0x1b1)]['width']='100%',_0x4580c1[_0x5ddb2a(0x1b1)]['height']='100%',_0x4580c1[_0x5ddb2a(0x1b1)]['pointerEvents']=this[_0x5ddb2a(0x19d)]?'auto':_0x5ddb2a(0x218),_0x4580c1[_0x5ddb2a(0x1b1)]['zIndex']=0xa,_0x4580c1['setAttribute']('id',_0x5ddb2a(0x199)),_0x4580c1['setAttribute'](_0x5ddb2a(0x266),'canvasWindy'),this['_map'][_0x5ddb2a(0x1f4)][_0x5ddb2a(0x252)](_0x4580c1);var _0x146bc6=this['_map']['scene'];return _0x4580c1['width']=_0x146bc6['canvas']['clientWidth'],_0x4580c1['height']=_0x146bc6['canvas']['clientHeight'],_0x4580c1;}},{'key':'resize','value':function _0x2fac5f(){var _0x5184c1=_0x27212d;this[_0x5184c1(0x202)]&&(this['canvas'][_0x5184c1(0x1a2)]=this['canvasWidth'],this['canvas']['height']=this['canvasHeight']);}},{'key':'bindEvent','value':function _0x75dfee(){var _0x1f8754=_0x27212d,_0x52a244=this,_0x587205=Date['now']();(function _0x2d322e(){var _0x415d44=_0x9e68;_0x52a244['animateFrame']=window['requestAnimationFrame'](_0x2d322e);if(_0x52a244['show']&&_0x52a244[_0x415d44(0x1f3)]){var _0x138d20=Date[_0x415d44(0x225)](),_0x2d0454=_0x138d20-_0x587205;_0x2d0454>_0x52a244[_0x415d44(0x245)]&&(_0x587205=_0x138d20-_0x2d0454%_0x52a244[_0x415d44(0x245)],_0x52a244[_0x415d44(0x1cd)]());}}(),window[_0x1f8754(0x1ce)](_0x1f8754(0x1aa),this['resize'][_0x1f8754(0x253)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x1f8754(0x1da)]['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x1f8754(0x1a3)][_0x1f8754(0x1d8)],this['_onMouseDownEvent'],this),this[_0x1f8754(0x1c4)]['on'](mars3d__namespace[_0x1f8754(0x1a3)][_0x1f8754(0x187)],this['_onMouseUpEvent'],this)));}},{'key':'unbindEvent','value':function _0x22ea34(){var _0x5bf7f6=_0x27212d;window['cancelAnimationFrame'](this[_0x5bf7f6(0x21a)]),delete this['animateFrame'],window[_0x5bf7f6(0x195)](_0x5bf7f6(0x1aa),this[_0x5bf7f6(0x1aa)]),this['options']['mouseHidden']&&(this['_map'][_0x5bf7f6(0x23f)](mars3d__namespace[_0x5bf7f6(0x1a3)][_0x5bf7f6(0x1e9)],this['_onMapWhellEvent'],this),this['_map'][_0x5bf7f6(0x23f)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x5bf7f6(0x1c4)]['off'](mars3d__namespace['EventType'][_0x5bf7f6(0x187)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace[_0x5bf7f6(0x1a3)]['mouseMove'],this[_0x5bf7f6(0x22b)],this));}},{'key':'_onMapWhellEvent','value':function _0x412db4(_0x4f4421){var _0x23bad7=_0x27212d,_0x2992da=this;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas']['style'][_0x23bad7(0x205)]='hidden',this['refreshTimer']=setTimeout(function(){var _0x4952b4=_0x23bad7;if(!_0x2992da['show'])return;_0x2992da['redraw'](),_0x2992da[_0x4952b4(0x202)]['style']['visibility']=_0x4952b4(0x21d);},0xc8);}},{'key':'_onMouseDownEvent','value':function _0x5eefda(_0x20fddb){var _0x3f7595=_0x27212d;this['mouse_down']=!![],this[_0x3f7595(0x1c4)]['off'](mars3d__namespace['EventType'][_0x3f7595(0x26e)],this['_onMouseMoveEvent'],this),this[_0x3f7595(0x1c4)]['on'](mars3d__namespace[_0x3f7595(0x1a3)]['mouseMove'],this[_0x3f7595(0x22b)],this);}},{'key':_0x27212d(0x22b),'value':function _0x45fc51(_0x180e65){var _0x203a04=_0x27212d;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this[_0x203a04(0x202)]['style']['visibility']='hidden',this[_0x203a04(0x1dc)]=!![]);}},{'key':_0x27212d(0x1c5),'value':function _0x2e7ed3(_0x4f014b){var _0x234982=_0x27212d;if(!this['show']||!this['canvas'])return;this['_map'][_0x234982(0x23f)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this[_0x234982(0x1dc)]&&this['redraw'](),this[_0x234982(0x202)]['style']['visibility']='visible',this[_0x234982(0x176)]=![],this['mouse_move']=![];}},{'key':_0x27212d(0x226),'value':function _0x3d51c7(_0x4242a8){var _0x3f456c=_0x27212d;this[_0x3f456c(0x233)](),this['windData']=_0x4242a8,this['windField']['setDate'](_0x4242a8),this['redraw']();}},{'key':_0x27212d(0x211),'value':function _0x4091ec(){var _0x3927b1=_0x27212d;if(!this[_0x3927b1(0x254)])return;this['windField']['setOptions'](this[_0x3927b1(0x1da)]),this['update']();}},{'key':_0x27212d(0x1cd),'value':function _0x40ebe7(){var _0xbaf34c=_0x27212d;if(this[_0xbaf34c(0x19e)])return;this[_0xbaf34c(0x19e)]=!![];if(this[_0xbaf34c(0x223)])this['windField']['update']();else{var _0x2c781a=this['windField']['getParticles']();this['_drawLines'](_0x2c781a);}this[_0xbaf34c(0x19e)]=![];}},{'key':'_drawLines','value':function _0x2e0a54(_0x56593b){var _0x559b23=_0x27212d;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext'][_0x559b23(0x277)]='lighter',this['canvasContext']['globalAlpha']=0.9,this['canvasContext'][_0x559b23(0x1eb)](),this[_0x559b23(0x22e)]['lineWidth']=this['lineWidth'],this[_0x559b23(0x22e)][_0x559b23(0x21b)]=this['color'];var _0x51d9c3=this['_map'][_0x559b23(0x265)][_0x559b23(0x196)]!==Cesium['SceneMode']['SCENE3D'];for(var _0x1ca56d=0x0,_0x224f3c=_0x56593b['length'];_0x1ca56d<_0x224f3c;_0x1ca56d++){var _0x429484=_0x56593b[_0x1ca56d],_0x127e24=this[_0x559b23(0x210)](_0x429484[_0x559b23(0x1c0)],_0x429484[_0x559b23(0x17b)],_0x429484),_0x41c44e=this[_0x559b23(0x210)](_0x429484[_0x559b23(0x1d7)],_0x429484[_0x559b23(0x1b9)],_0x429484);if(!_0x127e24||!_0x41c44e)continue;if(_0x51d9c3&&Math['abs'](_0x127e24[0x0]-_0x41c44e[0x0])>=this['canvasWidth'])continue;this['canvasContext']['moveTo'](_0x127e24[0x0],_0x127e24[0x1]),this['canvasContext'][_0x559b23(0x22c)](_0x41c44e[0x0],_0x41c44e[0x1]);}this[_0x559b23(0x22e)]['stroke']();}},{'key':'_tomap','value':function _0x59d06a(_0x545662,_0x5e3544,_0x344834){var _0x3a0b57=_0x27212d,_0x1ae17a=Cesium[_0x3a0b57(0x1d4)]['fromDegrees'](_0x545662,_0x5e3544,this[_0x3a0b57(0x1be)]),_0x11a80f=this['_map']['scene'];if(_0x11a80f['mode']===Cesium['SceneMode']['SCENE3D']){var _0x4a6347=new Cesium[(_0x3a0b57(0x23c))](_0x11a80f[_0x3a0b57(0x228)]['ellipsoid'],_0x11a80f['camera']['positionWC']),_0xa3d585=_0x4a6347[_0x3a0b57(0x243)](_0x1ae17a);if(!_0xa3d585)return _0x344834['age']=0x0,null;}var _0x2a96e4=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x1ae17a);return _0x2a96e4?[_0x2a96e4['x'],_0x2a96e4['y']]:null;}},{'key':'clear','value':function _0x2c3c1f(){this['windField']['clear'](),delete this['windData'];}},{'key':_0x27212d(0x1ea),'value':function _0x2c3db1(){var _0x1b4217=_0x27212d,_0x226726=this;this[_0x1b4217(0x223)]=new Worker(this['options']['worker']),this['worker'][_0x1b4217(0x237)]=function(_0x539185){var _0x4c4699=_0x1b4217;_0x226726[_0x4c4699(0x21c)](_0x539185['data']['particles']),_0x226726['_updateIng2']=![];},this['windField']={'init':function _0x4153fe(_0x1348cb){var _0x47da3f=_0x1b4217;_0x226726[_0x47da3f(0x223)]['postMessage']({'type':'init','options':_0x1348cb});},'setOptions':function _0x1a1047(_0x13ef2c){_0x226726['worker']['postMessage']({'type':'setOptions','options':_0x13ef2c});},'setDate':function _0x213886(_0x244592){var _0x4ea502=_0x1b4217;_0x226726['worker']['postMessage']({'type':_0x4ea502(0x220),'data':_0x244592});},'update':function _0x24ad90(){var _0x59e165=_0x1b4217;if(_0x226726[_0x59e165(0x1fe)])return;_0x226726[_0x59e165(0x1fe)]=!![],_0x226726['worker'][_0x59e165(0x1a6)]({'type':_0x59e165(0x1cd)});},'clear':function _0x5455ed(){var _0x5d61df=_0x1b4217;_0x226726[_0x5d61df(0x223)][_0x5d61df(0x1a6)]({'type':_0x5d61df(0x233)});}},this[_0x1b4217(0x1f3)][_0x1b4217(0x239)](this[_0x1b4217(0x1da)]);}}]),_0xabb2b1;}(BaseLayer);mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace[_0x2484ff(0x272)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x2484ff(0x1a7)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object[_0x2484ff(0x216)](exports,_0x2484ff(0x1ac),{'value':!![]});
}));
