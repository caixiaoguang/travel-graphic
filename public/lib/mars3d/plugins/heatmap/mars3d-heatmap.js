/**
 * Mars3D平台插件,结合heatmap可视化功能插件  mars3d-heatmap
 *
 * 版本信息：v3.4.20
 * 编译日期：2023-01-08 20:59:34
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2022-06-01
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d')), (window.h337 || require('@mars3d/heatmap.js'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d', '@mars3d/heatmap.js'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-heatmap"] = {}, global.mars3d, global.h337));
})(this, (function (exports, mars3d, h337) { 
'use strict';var _0x5559ea=_0x5eb7;function _0x5eb7(_0xa9fae9,_0x2c28e6){var _0x5ae249=_0x5ae2();return _0x5eb7=function(_0x5eb773,_0x258185){_0x5eb773=_0x5eb773-0x92;var _0x43b143=_0x5ae249[_0x5eb773];return _0x43b143;},_0x5eb7(_0xa9fae9,_0x2c28e6);}(function(_0x3cae28,_0x4b7c75){var _0x30d8a6={_0x39bad1:0xcd,_0x28b088:0x9a,_0x1f43f5:0xee,_0x557d4b:0xd3,_0x108900:0xd4,_0xb50fc3:0xff},_0x23b303=_0x5eb7,_0x54ae14=_0x3cae28();while(!![]){try{var _0x26a59d=-parseInt(_0x23b303(0xfc))/0x1*(-parseInt(_0x23b303(0xfe))/0x2)+parseInt(_0x23b303(_0x30d8a6._0x39bad1))/0x3+parseInt(_0x23b303(0xe9))/0x4+parseInt(_0x23b303(_0x30d8a6._0x28b088))/0x5*(parseInt(_0x23b303(_0x30d8a6._0x1f43f5))/0x6)+parseInt(_0x23b303(_0x30d8a6._0x557d4b))/0x7+-parseInt(_0x23b303(_0x30d8a6._0x108900))/0x8*(-parseInt(_0x23b303(0xd9))/0x9)+-parseInt(_0x23b303(_0x30d8a6._0xb50fc3))/0xa*(parseInt(_0x23b303(0xa3))/0xb);if(_0x26a59d===_0x4b7c75)break;else _0x54ae14['push'](_0x54ae14['shift']());}catch(_0x310523){_0x54ae14['push'](_0x54ae14['shift']());}}}(_0x5ae2,0xb5181));function _0x5ae2(){var _0x4c0394=['heatStyle','_scale','_addedHook','bind','function','granularity','create','_updatePositionsHook','StencilFunction','forEach','blue','div','container','parse','rectangle','arcBlurScale','filter','lng','setPositions','_heat','__proto__','keys','EllipsoidSurfaceAppearance','prototype','StencilOperation','layer','register','red','call','HeatLayer','getOwnPropertyDescriptor','请引入\x20heatmap.js\x20库\x20','_map','configurable','max','_graphic2','2497569xttAfn','_removedHook','green','_getHeatCanvas','Util','copyCanvas','9789073hVbUuu','88Mbadqu','formatRectangle','ALWAYS','uniforms','GraphicLayer','707724oZQexj','DomUtil','_createGraphic','xmin','LayerUtil','_mBoundsMax','xmax','options','setPrototypeOf','Color','_last_mBounds','arcDirection','image','value','ymax','style','4173716xhhQNt','lat','floor','min','_layer','804666EGocbh','PointTrans','height','round','clientWidth','bumpMap','positions','default','coordinates','diffHeight',';\x0a\x20\x20\x20\x20p\x20+=vec4(disPos,0.0);\x0a\x20\x20\x20\x20gl_Position\x20=\x20czm_modelViewProjectionRelativeToEye\x20*\x20p;\x0a\x20\x20}\x0a','_positions','concat','getOwnPropertyDescriptors','1qqsZEv','getPrototypeOf','722724ikulDk','113870ihMksi','length','construct','mars3d-heatmap\x20mars3d-hideDiv','clear','RectanglePrimitive','apply','Material','_graphic','_rectangle','_renderer','25oqQkqd','lonlat2mercator','_getArcHeatCanvas','opacity','defineProperty','maxCanvasSize','getPointData','sham','LngLatPoint','4279CUxnJt','push','BaseLayer','flyToByAnimationEnd','minCanvasSize','fromDegrees'];_0x5ae2=function(){return _0x4c0394;};return _0x5ae2();}function _interopNamespace(_0x58d219){var _0x3ec63a={_0x1e6e7a:0xbe,_0x5ce0d6:0xb2},_0x2c3ede=_0x5eb7;if(_0x58d219&&_0x58d219['__esModule'])return _0x58d219;var _0x5add57=Object[_0x2c3ede(0xaf)](null);return _0x58d219&&Object[_0x2c3ede(_0x3ec63a._0x1e6e7a)](_0x58d219)[_0x2c3ede(_0x3ec63a._0x5ce0d6)](function(_0x2b5bd6){if(_0x2b5bd6!=='default'){var _0x3f4dfb=Object['getOwnPropertyDescriptor'](_0x58d219,_0x2b5bd6);Object['defineProperty'](_0x5add57,_0x2b5bd6,_0x3f4dfb['get']?_0x3f4dfb:{'enumerable':!![],'get':function(){return _0x58d219[_0x2b5bd6];}});}}),_0x5add57[_0x2c3ede(0xf5)]=_0x58d219,_0x5add57;}var mars3d__namespace=_interopNamespace(mars3d),h337__namespace=_interopNamespace(h337);function ownKeys(_0xe1c2f3,_0x474c56){var _0x487980={_0x43daa3:0x95},_0x2c23dc={_0x1e987c:0xc7},_0x3c13db=_0x5eb7,_0xb65602=Object[_0x3c13db(0xbe)](_0xe1c2f3);if(Object['getOwnPropertySymbols']){var _0x5d3bac=Object['getOwnPropertySymbols'](_0xe1c2f3);_0x474c56&&(_0x5d3bac=_0x5d3bac[_0x3c13db(0xb9)](function(_0x4441ae){var _0x7e8741=_0x3c13db;return Object[_0x7e8741(_0x2c23dc._0x1e987c)](_0xe1c2f3,_0x4441ae)['enumerable'];})),_0xb65602['push'][_0x3c13db(_0x487980._0x43daa3)](_0xb65602,_0x5d3bac);}return _0xb65602;}function _objectSpread2(_0x462e8b){var _0x36ab1f={_0x5ce64a:0x100,_0x39344f:0xfb},_0x2a6e1b={_0x32f0c9:0xc7},_0x55e636=_0x5eb7;for(var _0x46b785=0x1;_0x46b785<arguments[_0x55e636(_0x36ab1f._0x5ce64a)];_0x46b785++){var _0x5bdf76=null!=arguments[_0x46b785]?arguments[_0x46b785]:{};_0x46b785%0x2?ownKeys(Object(_0x5bdf76),!0x0)['forEach'](function(_0x51fc27){_defineProperty(_0x462e8b,_0x51fc27,_0x5bdf76[_0x51fc27]);}):Object['getOwnPropertyDescriptors']?Object['defineProperties'](_0x462e8b,Object[_0x55e636(_0x36ab1f._0x39344f)](_0x5bdf76)):ownKeys(Object(_0x5bdf76))['forEach'](function(_0x2fe986){var _0x38a356=_0x55e636;Object[_0x38a356(0x9e)](_0x462e8b,_0x2fe986,Object[_0x38a356(_0x2a6e1b._0x32f0c9)](_0x5bdf76,_0x2fe986));});}return _0x462e8b;}function _classCallCheck(_0x1bc268,_0x11c049){if(!(_0x1bc268 instanceof _0x11c049))throw new TypeError('Cannot\x20call\x20a\x20class\x20as\x20a\x20function');}function _defineProperties(_0x537e5d,_0x2f771c){var _0x247b79={_0x31e51f:0xca,_0x15a15e:0xe6,_0x43b9c4:0x9e},_0x25ab39=_0x5eb7;for(var _0x52727f=0x0;_0x52727f<_0x2f771c['length'];_0x52727f++){var _0x31e0a9=_0x2f771c[_0x52727f];_0x31e0a9['enumerable']=_0x31e0a9['enumerable']||![],_0x31e0a9[_0x25ab39(_0x247b79._0x31e51f)]=!![];if(_0x25ab39(_0x247b79._0x15a15e)in _0x31e0a9)_0x31e0a9['writable']=!![];Object[_0x25ab39(_0x247b79._0x43b9c4)](_0x537e5d,_0x31e0a9['key'],_0x31e0a9);}}function _createClass(_0x158a1e,_0x477457,_0x4c6d0d){var _0x4f99a5={_0x3f7c97:0x9e},_0x287206=_0x5eb7;if(_0x477457)_defineProperties(_0x158a1e['prototype'],_0x477457);if(_0x4c6d0d)_defineProperties(_0x158a1e,_0x4c6d0d);return Object[_0x287206(_0x4f99a5._0x3f7c97)](_0x158a1e,_0x287206(0xc0),{'writable':![]}),_0x158a1e;}function _defineProperty(_0x505817,_0x2b927c,_0x51246c){return _0x2b927c in _0x505817?Object['defineProperty'](_0x505817,_0x2b927c,{'value':_0x51246c,'enumerable':!![],'configurable':!![],'writable':!![]}):_0x505817[_0x2b927c]=_0x51246c,_0x505817;}function _inherits(_0x3eb22f,_0x498232){var _0x11e83f=_0x5eb7;if(typeof _0x498232!=='function'&&_0x498232!==null)throw new TypeError('Super\x20expression\x20must\x20either\x20be\x20null\x20or\x20a\x20function');_0x3eb22f['prototype']=Object['create'](_0x498232&&_0x498232['prototype'],{'constructor':{'value':_0x3eb22f,'writable':!![],'configurable':!![]}}),Object['defineProperty'](_0x3eb22f,_0x11e83f(0xc0),{'writable':![]});if(_0x498232)_setPrototypeOf(_0x3eb22f,_0x498232);}function _getPrototypeOf(_0x3a7b8f){var _0x50f563={_0x1abc21:0xac},_0x502f52=_0x5eb7;return _getPrototypeOf=Object['setPrototypeOf']?Object[_0x502f52(0xfd)][_0x502f52(_0x50f563._0x1abc21)]():function _0x2ecf69(_0x103233){return _0x103233['__proto__']||Object['getPrototypeOf'](_0x103233);},_getPrototypeOf(_0x3a7b8f);}function _setPrototypeOf(_0x105551,_0x2d4d9c){var _0x2b64f8={_0x1dca10:0xac},_0x55529b={_0x1a84fb:0xbd},_0x220fa5=_0x5eb7;return _setPrototypeOf=Object['setPrototypeOf']?Object[_0x220fa5(0xe1)][_0x220fa5(_0x2b64f8._0x1dca10)]():function _0x584520(_0x4d1f6d,_0x1e8c35){var _0x41bd13=_0x220fa5;return _0x4d1f6d[_0x41bd13(_0x55529b._0x1a84fb)]=_0x1e8c35,_0x4d1f6d;},_setPrototypeOf(_0x105551,_0x2d4d9c);}function _isNativeReflectConstruct(){var _0x304807={_0x2ee6c8:0x101,_0x3d7ddb:0xa1,_0x241088:0xad},_0x16bbb2=_0x5eb7;if(typeof Reflect==='undefined'||!Reflect[_0x16bbb2(_0x304807._0x2ee6c8)])return![];if(Reflect['construct'][_0x16bbb2(_0x304807._0x3d7ddb)])return![];if(typeof Proxy===_0x16bbb2(_0x304807._0x241088))return!![];try{return Boolean[_0x16bbb2(0xc0)]['valueOf'][_0x16bbb2(0xc5)](Reflect['construct'](Boolean,[],function(){})),!![];}catch(_0x30fc6d){return![];}}function _assertThisInitialized(_0x356f10){if(_0x356f10===void 0x0)throw new ReferenceError('this\x20hasn\x27t\x20been\x20initialised\x20-\x20super()\x20hasn\x27t\x20been\x20called');return _0x356f10;}function _possibleConstructorReturn(_0x9e609c,_0x16be45){if(_0x16be45&&(typeof _0x16be45==='object'||typeof _0x16be45==='function'))return _0x16be45;else{if(_0x16be45!==void 0x0)throw new TypeError('Derived\x20constructors\x20may\x20only\x20return\x20object\x20or\x20undefined');}return _assertThisInitialized(_0x9e609c);}function _createSuper(_0x5aba97){var _0x3016ce=_isNativeReflectConstruct();return function _0x59eac6(){var _0x4b0f1e=_getPrototypeOf(_0x5aba97),_0x153a45;if(_0x3016ce){var _0x480c7d=_getPrototypeOf(this)['constructor'];_0x153a45=Reflect['construct'](_0x4b0f1e,arguments,_0x480c7d);}else _0x153a45=_0x4b0f1e['apply'](this,arguments);return _possibleConstructorReturn(this,_0x153a45);};}var HeatMaterial='uniform\x20sampler2D\x20image;\x0a\x0aczm_material\x20czm_getMaterial(czm_materialInput\x20materialInput)\x20{\x0a\x20\x20czm_material\x20material\x20=\x20czm_getDefaultMaterial(materialInput);\x0a\x20\x20vec2\x20st\x20=\x20materialInput.st;\x0a\x20\x20vec4\x20colorImage\x20=\x20texture2D(image,\x20st);\x0a\x20\x20if(colorImage.rgb\x20==\x20vec3(1.0)\x20||\x20colorImage.rgb\x20==\x20vec3(0.0))\x20{\x0a\x20\x20\x20\x20discard;\x0a\x20\x20}\x0a\x20\x20material.diffuse\x20=\x20colorImage.rgb;\x0a\x20\x20material.alpha\x20=\x20colorImage.a;\x0a\x20\x20return\x20material;\x0a}\x0a';if(!h337__namespace['create'])throw new Error(_0x5559ea(0xc8));var Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer'][_0x5559ea(0xa5)],DEF_HEATSTYLE={'maxOpacity':0.8,'minOpacity':0.1,'blur':0.85,'radius':0x19,'gradient':{0.4:_0x5559ea(0xb3),0.6:_0x5559ea(0xcf),0.8:'yellow',0.9:_0x5559ea(0xc4)}},DEF_STYLE={'arcRadiusScale':1.5,'arcBlurScale':1.5,'vertexFormat':Cesium['EllipsoidSurfaceAppearance']['VERTEX_FORMAT']},HeatLayer=function(_0x2ba69c){var _0x42de14={_0x5c514a:0xf6,_0x161b06:0xab,_0x421b59:0xd0,_0x396d59:0x9c,_0x3193e6:0xa0},_0x31c170={_0x49d4fa:0x9b,_0x535c1e:0xaa,_0x38602a:0xf1,_0x26a698:0xe7},_0x4a57f5={_0x38c631:0xbc},_0x156bcd={_0x2eee33:0xdc,_0x393d40:0xde,_0x5088e7:0xcb,_0x136f9f:0xe3,_0x1d0dae:0xa9,_0x5a9931:0xa9,_0x5b0563:0xaf},_0x7a3d2d={_0x304fde:0xb7,_0xac7887:0xba,_0x3e9186:0xa4},_0x523321={_0x387492:0xd5},_0x216010={_0x5526e5:0xb1,_0x502b9f:0xc1,_0x496104:0xeb,_0x428b65:0xf7,_0x5b2ab8:0xf0,_0x3e2f45:0xe8,_0x72d01d:0xe4,_0x312ff7:0x97,_0x7fbb74:0x98,_0x29e80e:0xed},_0x3a8385={_0x41a494:0x93,_0x4872b1:0xe0},_0x2045a5={_0x366c3b:0xc9,_0x2d067:0xed,_0x17893b:0x9d,_0xae7359:0x97,_0xf98c29:0x97,_0x50b994:0xd7,_0x9bbc10:0xf3,_0x33f207:0xcc,_0x296103:0xe5},_0x3444d4={_0x40d9f1:0x97},_0x1c83f5={_0x4c681c:0xf9},_0x296b50={_0x229f3a:0xb0},_0x39fb39={_0x20618d:0xb5,_0x47f970:0xda},_0x50ddae={_0x5f1f7f:0xc9,_0x3d7e76:0xa6},_0x471e55={_0x49fcd0:0xe8,_0x1e7d73:0xed},_0x267c08={_0x4ca796:0xf9},_0x460245={_0x21cbc9:0xe8},_0x404841={_0x92fefb:0xe0},_0x3c5e8f={_0x28ce0e:0xf2,_0x537c43:0x9f,_0x1dfb4f:0xa7,_0x3f678e:0xe0,_0x5a2f04:0xe0},_0x14bba2=_0x5559ea;_inherits(_0x2cafbf,_0x2ba69c);var _0x222569=_createSuper(_0x2cafbf);function _0x2cafbf(){var _0x28de76=_0x5eb7,_0x32e884,_0xd858bd,_0x95b912,_0x159dd4=arguments['length']>0x0&&arguments[0x0]!==undefined?arguments[0x0]:{};return _classCallCheck(this,_0x2cafbf),_0x95b912=_0x222569['call'](this,_0x159dd4),_0x95b912['options']['maxCanvasSize']=(_0x32e884=_0x95b912['options']['maxCanvasSize'])!==null&&_0x32e884!==void 0x0?_0x32e884:document['body'][_0x28de76(_0x3c5e8f._0x28ce0e)],_0x95b912[_0x28de76(0xe0)][_0x28de76(_0x3c5e8f._0x537c43)]=Math[_0x28de76(0xec)](_0x95b912['options']['maxCanvasSize'],0x1388),_0x95b912[_0x28de76(0xe0)]['minCanvasSize']=(_0xd858bd=_0x95b912[_0x28de76(0xe0)][_0x28de76(_0x3c5e8f._0x1dfb4f)])!==null&&_0xd858bd!==void 0x0?_0xd858bd:document['body']['clientHeight'],_0x95b912[_0x28de76(_0x3c5e8f._0x3f678e)][_0x28de76(0xa7)]=Math['max'](_0x95b912[_0x28de76(_0x3c5e8f._0x5a2f04)]['minCanvasSize'],0x2bc),_0x95b912['options']['heatStyle']=_objectSpread2(_objectSpread2({},DEF_HEATSTYLE),_0x95b912['options'][_0x28de76(0xa9)]||{}),_0x95b912['options']['style']=_objectSpread2(_objectSpread2({},DEF_STYLE),_0x95b912['options']['style']||{}),_0x95b912;}return _createClass(_0x2cafbf,[{'key':'layer','get':function _0x3acfda(){var _0x1503e2=_0x5eb7;return this[_0x1503e2(0xed)];}},{'key':'heatStyle','get':function _0x336fc5(){return this['options']['heatStyle'];},'set':function _0x4046bb(_0x1f7d6f){var _0x4e577d=_0x5eb7;this['options']['heatStyle']=mars3d__namespace[_0x4e577d(0xd1)]['merge'](this[_0x4e577d(_0x404841._0x92fefb)]['heatStyle'],_0x1f7d6f),this['_heat']&&(this['_heat']['configure'](this['options']['heatStyle']),this['_updatePositionsHook'](!![]));}},{'key':'style','get':function _0x281e59(){var _0x56979d=_0x5eb7;return this['options'][_0x56979d(_0x460245._0x21cbc9)];},'set':function _0x33948c(_0x16495b){var _0x790bae=_0x5eb7;this['options']['style']=mars3d__namespace[_0x790bae(0xd1)]['merge'](this[_0x790bae(0xe0)]['style'],_0x16495b);}},{'key':'positions','get':function _0x5779bc(){var _0x3e9205=_0x5eb7;return this[_0x3e9205(_0x267c08._0x4ca796)];},'set':function _0x19d3cf(_0x13ea79){this['setPositions'](_0x13ea79);}},{'key':_0x14bba2(_0x42de14._0x5c514a),'get':function _0x2870dd(){var _0x5d1181=[];return this['points']['forEach'](function(_0x55dd99){_0x5d1181['push'](_0x55dd99['toArray']());}),_0x5d1181;}},{'key':'rectangle','get':function _0x154203(){return this['_rectangle'];}},{'key':'_setOptionsHook','value':function _0x5aac0b(_0x449a6d,_0x283a56){var _0x2384b1=_0x14bba2;_0x449a6d['positions']&&(this['positions']=_0x449a6d[_0x2384b1(0xf4)]);}},{'key':'_mountedHook','value':function _0x1beaaf(){var _0x5a7fd3=_0x14bba2;this[_0x5a7fd3(_0x471e55._0x49fcd0)]['type']==='image'?this['_layer']=new mars3d__namespace[(_0x5a7fd3(0xc2))]['ImageLayer']({'crs':'EPSG:3857','private':!![]}):this[_0x5a7fd3(_0x471e55._0x1e7d73)]=new mars3d__namespace['layer'][(_0x5a7fd3(0xd8))]({'private':!![]});}},{'key':_0x14bba2(_0x42de14._0x161b06),'value':function _0x3a820f(){var _0x3535ca=_0x14bba2;this[_0x3535ca(_0x50ddae._0x5f1f7f)]['addLayer'](this['_layer']),this['options']['positions']&&(this['positions']=this['options']['positions']),this['options']['flyTo']&&this[_0x3535ca(_0x50ddae._0x3d7e76)]();}},{'key':_0x14bba2(0xce),'value':function _0x4ff791(){var _0xb9f4f4=_0x14bba2;this['heatStyle'][_0xb9f4f4(_0x39fb39._0x20618d)]&&(mars3d__namespace[_0xb9f4f4(_0x39fb39._0x47f970)]['remove'](this['heatStyle']['container']),delete this['heatStyle']['container']),this['clear'](),this['_map']['removeLayer'](this['_layer']);}},{'key':'addPosition','value':function _0x3df3b1(_0x3d792d,_0x4b29b2){var _0x376548=_0x14bba2;this['_positions']=this['_positions']||[],this['_positions']['push'](_0x3d792d),this[_0x376548(_0x296b50._0x229f3a)](_0x4b29b2);}},{'key':_0x14bba2(0xbb),'value':function _0x53bd3a(_0x9926d9,_0x51872f){var _0x578f4b=_0x14bba2;this[_0x578f4b(_0x1c83f5._0x4c681c)]=_0x9926d9,this['_updatePositionsHook'](_0x51872f);}},{'key':'clear','value':function _0x11f94c(){var _0x545338=_0x14bba2;this['_graphic']&&(this[_0x545338(0xed)]['removeGraphic'](this[_0x545338(_0x3444d4._0x40d9f1)],!![]),delete this[_0x545338(0x97)]),this['_graphic2']&&(this['_layer']['removeGraphic'](this[_0x545338(0xcc)],!![]),delete this[_0x545338(0xcc)]);}},{'key':'_updatePositionsHook','value':function _0x265dee(_0x5b672a){var _0x534d0f=_0x14bba2;if(!this['show']||!this[_0x534d0f(_0x2045a5._0x366c3b)]||!this[_0x534d0f(0xf4)]||this['positions']['length']===0x0)return this;var _0x4893bd=this['_getHeatCanvas']();if(this['style']['type']===_0x534d0f(0xe5))this[_0x534d0f(_0x2045a5._0x2d067)]['setOptions']({'url':_0x4893bd['toDataURL']('image/png'),'rectangle':this['_rectangle'],'opacity':this['style'][_0x534d0f(_0x2045a5._0x17893b)]});else this['style']['arc']?this[_0x534d0f(_0x2045a5._0xae7359)]&&_0x5b672a?(this[_0x534d0f(_0x2045a5._0xf98c29)][_0x534d0f(_0x2045a5._0x50b994)]['image']=_0x4893bd,this['_graphic']['uniforms'][_0x534d0f(_0x2045a5._0x9bbc10)]=this[_0x534d0f(0x9c)](),this['_graphic2']&&(this[_0x534d0f(_0x2045a5._0x33f207)][_0x534d0f(_0x2045a5._0x50b994)][_0x534d0f(_0x2045a5._0x296103)]=_0x4893bd,this['_graphic2'][_0x534d0f(0xd7)]['bumpMap']=this['_graphic']['uniforms'][_0x534d0f(0xf3)])):this['_createArcGraphic'](_0x4893bd):this[_0x534d0f(0x97)]&&_0x5b672a?this['_graphic']['uniforms']['image']=_0x4893bd:this[_0x534d0f(0xdb)](_0x4893bd);return this;}},{'key':'_createGraphic','value':function _0x5a69a2(_0x12b6e7){var _0x52fa55=_0x14bba2;this[_0x52fa55(_0x3a8385._0x41a494)](),this[_0x52fa55(0x97)]=new mars3d__namespace['graphic'][(_0x52fa55(0x94))](_objectSpread2(_objectSpread2({},this[_0x52fa55(_0x3a8385._0x4872b1)]),{},{'rectangle':this['_rectangle'],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'material':new Cesium[(_0x52fa55(0x96))]({'fabric':{'uniforms':{'image':_0x12b6e7},'source':HeatMaterial},'translucent':!![]}),'flat':!![]})})),this['_layer']['addGraphic'](this['_graphic']);}},{'key':'_createArcGraphic','value':function _0x199625(_0x5d2b66){var _0x5c3538=_0x14bba2,_0x2cf81b;this['clear']();var _0x54ed6e=Cesium['RenderState']['fromCache']({'cull':{'enabled':!![]},'depthTest':{'enabled':!![]},'stencilTest':{'enabled':!![],'frontFunction':Cesium[_0x5c3538(_0x216010._0x5526e5)][_0x5c3538(0xd6)],'frontOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'backFunction':Cesium['StencilFunction']['ALWAYS'],'backOperation':{'fail':Cesium[_0x5c3538(0xc1)]['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium[_0x5c3538(_0x216010._0x502b9f)]['REPLACE']},'reference':0x2,'mask':0x2},'blending':Cesium['BlendingState']['ALPHA_BLEND']}),_0xf72b0a=Math[_0x5c3538(_0x216010._0x496104)]((_0x2cf81b=this['style']['diffHeight'])!==null&&_0x2cf81b!==void 0x0?_0x2cf81b:this['_mBoundsMax']*0.02)+0.1;this['style'][_0x5c3538(_0x216010._0x428b65)]&&delete this['style']['diffHeight'];var _0x245201=(this[_0x5c3538(0xe8)]['splitNum'],0x64),_0x7761f6=Math['max'](this['_rectangle'][_0x5c3538(_0x216010._0x5b2ab8)],this[_0x5c3538(0x98)]['width']);this['style'][_0x5c3538(0xae)]=_0x7761f6/=_0x245201;var _0x28460d=new Cesium['Material']({'fabric':{'uniforms':{'image':_0x5d2b66,'repeat':new Cesium['Cartesian2'](0x1,0x1),'color':new Cesium[(_0x5c3538(0xe2))](0x1,0x1,0x1,0x0),'bumpMap':this['_getArcHeatCanvas']()},'source':HeatMaterial},'translucent':!![]}),_0x2d7961=this[_0x5c3538(_0x216010._0x3e2f45)][_0x5c3538(_0x216010._0x72d01d)]||0x1;this[_0x5c3538(_0x216010._0x312ff7)]=new mars3d__namespace['graphic']['RectanglePrimitive'](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this[_0x5c3538(_0x216010._0x7fbb74)],'appearance':new Cesium[(_0x5c3538(0xbf))]({'flat':!![],'aboveGround':!![],'renderState':_0x54ed6e,'material':_0x28460d,'vertexShaderSource':getVertexShaderSource(_0xf72b0a*_0x2d7961)})})),this['_layer']['addGraphic'](this['_graphic']),this['style']['arcDirection']===0x0&&(this['_graphic2']=new mars3d__namespace['graphic']['RectanglePrimitive'](_objectSpread2(_objectSpread2({},this['options']),{},{'rectangle':this[_0x5c3538(_0x216010._0x7fbb74)],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x54ed6e,'material':_0x28460d,'vertexShaderSource':getVertexShaderSource(-_0xf72b0a)})})),this[_0x5c3538(_0x216010._0x29e80e)]['addGraphic'](this[_0x5c3538(0xcc)]));}},{'key':'getRectangle','value':function _0x2cfd6a(_0x5623ff){var _0x5c50bf=_0x14bba2;return _0x5623ff!==null&&_0x5623ff!==void 0x0&&_0x5623ff['isFormat']&&this['_rectangle']?mars3d__namespace['PolyUtil'][_0x5c50bf(_0x523321._0x387492)](this['_rectangle']):this[_0x5c50bf(0x98)];}},{'key':_0x14bba2(_0x42de14._0x421b59),'value':function _0x56c0c7(){var _0x5b59e3={_0x203415:0x9b,_0x38c666:0xba},_0x6eaecc=_0x14bba2,_0xd5de11=this,_0x30b5da,_0x308b3a,_0x4ff482,_0x4b66e7,_0x5b142b=this['_positions'],_0x3a334e=[],_0x59f28a,_0x42f115,_0x440782,_0x38e49e;_0x5b142b['forEach'](function(_0x3fc0a1){var _0x5def14=_0x5eb7,_0x1005e6=mars3d__namespace['LngLatPoint']['parse'](_0x3fc0a1);if(!_0x1005e6)return;_0x1005e6[_0x5def14(0xe6)]=_0x3fc0a1['value']||0x1,!_0xd5de11['options'][_0x5def14(_0x7a3d2d._0x304fde)]&&(_0x59f28a===undefined?(_0x59f28a=_0x1005e6[_0x5def14(_0x7a3d2d._0xac7887)],_0x42f115=_0x1005e6[_0x5def14(0xba)],_0x440782=_0x1005e6[_0x5def14(0xea)],_0x38e49e=_0x1005e6['lat']):(_0x59f28a=Math[_0x5def14(0xec)](_0x59f28a,_0x1005e6[_0x5def14(_0x7a3d2d._0xac7887)]),_0x42f115=Math['max'](_0x42f115,_0x1005e6[_0x5def14(0xba)]),_0x440782=Math['min'](_0x440782,_0x1005e6['lat']),_0x38e49e=Math['max'](_0x38e49e,_0x1005e6[_0x5def14(0xea)]))),_0x3a334e[_0x5def14(_0x7a3d2d._0x3e9186)](_0x1005e6);});var _0x51097e=this['options'][_0x6eaecc(0xb7)]||{'xmin':_0x59f28a,'xmax':_0x42f115,'ymin':_0x440782,'ymax':_0x38e49e},_0x18b053=getMercatorBounds(_0x51097e),_0x295a3b=Math['abs'](_0x18b053['xmax']-_0x18b053[_0x6eaecc(_0x156bcd._0x2eee33)]),_0x3c0009=Math['abs'](_0x18b053[_0x6eaecc(0xe7)]-_0x18b053['ymin']),_0x3566b1=Math['max'](_0x295a3b,_0x3c0009),_0x58f6eb=Math['min'](_0x295a3b,_0x3c0009);this[_0x6eaecc(_0x156bcd._0x393d40)]=_0x3566b1;var _0x149da2=0x1;if(_0x3566b1>this['options']['maxCanvasSize'])_0x149da2=_0x3566b1/this['options']['maxCanvasSize'],_0x58f6eb/_0x149da2<this['options']['minCanvasSize']&&(_0x149da2=_0x58f6eb/this['options']['minCanvasSize']);else _0x58f6eb<this['options']['minCanvasSize']&&(_0x149da2=_0x58f6eb/this[_0x6eaecc(0xe0)]['minCanvasSize'],_0x3566b1/_0x149da2>this['options']['maxCanvasSize']&&(_0x149da2=_0x3566b1/this['options']['maxCanvasSize']));var _0x5e8adb=this['heatStyle']['radius']*1.5,_0x14957c=_0x295a3b/_0x149da2+_0x5e8adb*0x2,_0x26c1cf=_0x3c0009/_0x149da2+_0x5e8adb*0x2,_0x562868=_0x5e8adb*_0x149da2;_0x18b053['xmin']-=_0x562868,_0x18b053['ymin']-=_0x562868,_0x18b053['xmax']+=_0x562868,_0x18b053['ymax']+=_0x562868,this['_scale']=_0x149da2,_0x51097e=geLatLngBounds(_0x18b053),this['_rectangle']=Cesium['Rectangle'][_0x6eaecc(0xa8)](_0x51097e['xmin'],_0x51097e['ymin'],_0x51097e[_0x6eaecc(0xdf)],_0x51097e['ymax']);var _0x496614=(_0x30b5da=_0x3a334e[0x0][_0x6eaecc(0xe6)])!==null&&_0x30b5da!==void 0x0?_0x30b5da:0x1,_0x20569e=(_0x308b3a=_0x3a334e[0x0]['value'])!==null&&_0x308b3a!==void 0x0?_0x308b3a:0x0,_0x21897e=[];_0x3a334e['forEach'](function(_0x5d8d4d){var _0x2d64e3=_0x6eaecc,_0x2d52d0=mars3d__namespace['PointTrans'][_0x2d64e3(_0x5b59e3._0x203415)]([_0x5d8d4d[_0x2d64e3(_0x5b59e3._0x38c666)],_0x5d8d4d['lat']]),_0x400da5=_0x5d8d4d['value']||0x1,_0x39bf15=Math['round']((_0x2d52d0[0x0]-_0x18b053['xmin'])/_0x149da2),_0x20cf79=Math['round']((_0x18b053['ymax']-_0x2d52d0[0x1])/_0x149da2);_0x496614=Math['max'](_0x496614,_0x400da5),_0x20569e=Math[_0x2d64e3(0xec)](_0x20569e,_0x400da5),_0x21897e['push']({'x':_0x39bf15,'y':_0x20cf79,'value':_0x400da5});});var _0x4dd4f3={'min':(_0x4ff482=this['options']['min'])!==null&&_0x4ff482!==void 0x0?_0x4ff482:_0x20569e,'max':(_0x4b66e7=this['options'][_0x6eaecc(_0x156bcd._0x5088e7)])!==null&&_0x4b66e7!==void 0x0?_0x4b66e7:_0x496614,'data':_0x21897e};this['_last_heatData']=_0x4dd4f3;(!this['_last_mBounds']||_0x18b053[_0x6eaecc(0xdc)]!==this[_0x6eaecc(_0x156bcd._0x136f9f)]['xmin']||_0x18b053['ymin']!==this[_0x6eaecc(0xe3)]['ymin']||_0x18b053['xmax']!==this['_last_mBounds']['xmax']||_0x18b053['ymax']!==this['_last_mBounds']['ymax'])&&(this['_last_mBounds']=_0x18b053,!this[_0x6eaecc(_0x156bcd._0x1d0dae)][_0x6eaecc(0xb5)]&&(this[_0x6eaecc(_0x156bcd._0x5a9931)]['container']=mars3d__namespace[_0x6eaecc(0xda)]['create'](_0x6eaecc(0xb4),_0x6eaecc(0x92),this['_map']['container'])),this[_0x6eaecc(0xa9)]['container']['style']['cssText']='width:'['concat'](_0x14957c,'px;height:')['concat'](_0x26c1cf,'px;'),!this['_heat']?this['_heat']=h337__namespace[_0x6eaecc(_0x156bcd._0x5b0563)](this['heatStyle']):this['_heat']['configure'](this['heatStyle']));this['_heat']['setData'](_0x4dd4f3);var _0x54c555=mars3d__namespace['DomUtil'][_0x6eaecc(0xd2)](this['_heat']['_renderer']['canvas']);return _0x54c555;}},{'key':_0x14bba2(_0x42de14._0x396d59),'value':function _0x277aa6(){var _0x555bb9=_0x14bba2;this['_heat']['configure']({'radius':this['heatStyle']['radius']*this['style']['arcRadiusScale'],'blur':this['heatStyle']['blur']*this['style'][_0x555bb9(0xb8)],'gradient':this['heatStyle']['gradientArc']||{0.25:'rgb(0,0,0)',0.55:'rgb(140,140,140)',0.85:'rgb(216,216,216)',0x1:'rgb(255,255,255)'}});var _0x5d2f21=mars3d__namespace['DomUtil']['copyCanvas'](this[_0x555bb9(_0x4a57f5._0x38c631)]['_renderer']['canvas']);return this['_heat']['configure'](this['options']['heatStyle']),_0x5d2f21;}},{'key':_0x14bba2(_0x42de14._0x3193e6),'value':function _0x59ef07(_0xba3684){var _0x482466=_0x14bba2,_0xbccc98=mars3d__namespace[_0x482466(0xa2)][_0x482466(0xb6)](_0xba3684);if(!_0xbccc98)return{};var _0x239e94=mars3d__namespace['PointTrans'][_0x482466(_0x31c170._0x49d4fa)]([_0xbccc98['lng'],_0xbccc98['lat']]),_0x3d0649=this['_last_mBounds'],_0x1785dd=Math['round']((_0x239e94[0x0]-_0x3d0649['xmin'])/this[_0x482466(_0x31c170._0x535c1e)]),_0x3b474a=Math[_0x482466(_0x31c170._0x38602a)]((_0x3d0649[_0x482466(_0x31c170._0x26a698)]-_0x239e94[0x1])/this['_scale']),_0x3e4852=this[_0x482466(0xbc)]['getValueAt']({'x':_0x1785dd,'y':_0x3b474a}),_0x256ba5=this['_heat'][_0x482466(0x99)]['ctx']['getImageData'](_0x1785dd-0x1,_0x3b474a-0x1,0x1,0x1)['data'];return{'x':_0x1785dd,'y':_0x3b474a,'value':_0x3e4852,'color':'rgba('+_0x256ba5[0x0]+','+_0x256ba5[0x1]+','+_0x256ba5[0x2]+','+_0x256ba5[0x3]+')'};}}]),_0x2cafbf;}(BaseLayer);mars3d__namespace['layer'][_0x5559ea(0xc6)]=HeatLayer,mars3d__namespace[_0x5559ea(0xdd)][_0x5559ea(0xc3)]('heat',HeatLayer);function getMercatorBounds(_0x54c899){var _0xb2fc61={_0x55e7de:0x9b},_0x38db6e=_0x5559ea,_0x4c366f=mars3d__namespace['PointTrans'][_0x38db6e(_0xb2fc61._0x55e7de)]([_0x54c899['xmin'],_0x54c899['ymin']]),_0x46a85a=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x54c899['xmax'],_0x54c899['ymax']]);return{'xmin':_0x4c366f[0x0],'ymin':_0x4c366f[0x1],'xmax':_0x46a85a[0x0],'ymax':_0x46a85a[0x1]};}function geLatLngBounds(_0x56e2ac){var _0x48c93e={_0x230131:0xef,_0xbbc8fd:0xdf},_0x360fba=_0x5559ea,_0x557157=mars3d__namespace[_0x360fba(_0x48c93e._0x230131)]['mercator2lonlat']([_0x56e2ac['xmin'],_0x56e2ac['ymin']]),_0xfb7d33=mars3d__namespace['PointTrans']['mercator2lonlat']([_0x56e2ac[_0x360fba(_0x48c93e._0xbbc8fd)],_0x56e2ac['ymax']]);return{'xmin':_0x557157[0x0],'ymin':_0x557157[0x1],'xmax':_0xfb7d33[0x0],'ymax':_0xfb7d33[0x1]};}function getVertexShaderSource(_0x3848fc){var _0x1efe0e=_0x5559ea;return'attribute\x20vec3\x20position3DHigh;\x0a\x20\x20attribute\x20vec3\x20position3DLow;\x0a\x20\x20attribute\x20vec2\x20st;\x0a\x20\x20attribute\x20float\x20batchId;\x0a\x20\x20uniform\x20sampler2D\x20bumpMap_3;\x0a\x20\x20varying\x20vec3\x20v_positionMC;\x0a\x20\x20varying\x20vec3\x20v_positionEC;\x0a\x20\x20varying\x20vec2\x20v_st;\x0a\x0a\x20\x20void\x20main()\x0a\x20\x20{\x0a\x20\x20\x20\x20vec4\x20p\x20=\x20czm_computePosition();\x0a\x20\x20\x20\x20v_positionMC\x20=\x20position3DHigh\x20+\x20position3DLow;\x0a\x20\x20\x20\x20v_positionEC\x20=\x20(czm_modelViewRelativeToEye\x20*\x20p).xyz;\x0a\x20\x20\x20\x20v_st\x20=\x20st;\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture2D(bumpMap_3,\x20v_st);\x0a\x20\x20\x20\x20float\x20centerBump\x20=\x20distance(vec3(0.0),color.rgb);\x0a\x20\x20\x20\x20vec3\x20upDir\x20=\x20normalize(v_positionMC.xyz);\x0a\x20\x20\x20\x20vec3\x20disPos\x20=\x20upDir\x20*\x20centerBump\x20*\x20'[_0x1efe0e(0xfa)](_0x3848fc,_0x1efe0e(0xf8));}exports['HeatLayer']=HeatLayer,Object[_0x5559ea(0x9e)](exports,'__esModule',{'value':!![]});
}));
